import{at as D,g as M,r as u,V as O,k as W,c as Q,o as s,w as r,b as l,a as t,f as i,Q as y,e as x,a5 as q,au as Z,u as G,a1 as f,a2 as _,a3 as w,W as h,Z as b,t as c,a0 as H,_ as J,a7 as K,b1 as S,h as X,as as Y}from"./index-BU3plpon.js";import{c as ee,Q as ae,a as U,b as $}from"./QList-Cr0s9WA1.js";import{Q as le}from"./QChip-BnQaoy-Y.js";import{Q as z}from"./QSpace-CyY_c82_.js";import{Q as te}from"./QMarkupTable-B1jPLfSb.js";import{Q as oe}from"./QForm-Do5n-57R.js";import{Q as re}from"./QPage-C7Cuzh7s.js";import{u as ne}from"./use-quasar-D--VCyB-.js";const se={class:"row"},de={class:"col-12"},ue={class:"col-12 col-md-5"},ie={class:"text-grey text-caption"},ce={key:0},pe={class:"col-12 col-md-7"},me={class:"div"},ve={class:"text-h6 row items-center"},fe={style:{"wrap-option":"break-word",width:"120px","line-height":"0.8"}},be=["onUpdate:modelValue"],ge=["onUpdate:modelValue"],Ce={class:"text-bold"},Pe={__name:"CompraAdd",setup(Ve){const L=D(),{proxy:p}=M(),g=u({nombre:""}),k=u([]),P=u([]),n=u([]);let m=u("");const C=u(!1),v=u(!1),R=ne();O(()=>{F()});function E(o){R.dialog({title:"Calcular Caja",html:!0,message:`Producto: ${o.nombre} <br> Cantidad: ${o.cantidadVenta}`,prompt:{type:"number",label:"Total de cajas",min:1,max:1e5,required:!0},cancel:!0,ok:{label:"Calcular",color:"primary"}}).onOk(e=>{const a=e/o.cantidadVenta;console.log(a),o.precioVenta=a.toFixed(3)})}function F(){p.$axios.get("/productos").then(o=>{k.value=o.data,P.value=o.data})}const B=W(()=>n.value.reduce((o,e)=>o+e.cantidadVenta*e.precioVenta,0).toFixed(2));function I(){k.value=P.value.filter(o=>o.nombre.toLowerCase().includes(m.value.toLowerCase()))}function N(o){const e=n.value.find(a=>a.id===o.id);e?e.cantidadVenta++:n.value.push({...o,cantidadVenta:1,precioVenta:o.precio})}function T(o){n.value.splice(o,1)}function j(){if(n.value.length===0){p.$alert.error("El carrito está vacío","Error");return}C.value=!0,g.value={nombre:"Proveedor"}}function A(){if(n.value.length===0){p.$alert.error("El carrito está vacío");return}v.value=!0,p.$axios.post("/compras",{...g.value,total:B.value,productos:n.value}).then(async()=>{n.value=[],g.value={nombre:""},C.value=!1,p.$alert.success("Compra registrada con éxito","Éxito"),L.push("/compras"),m.value=""}).catch(o=>{p.$alert.error(o.response.data.message,"Error")}).finally(()=>{v.value=!1})}return(o,e)=>(s(),Q(re,{class:"q-pa-xs"},{default:r(()=>[l("div",se,[l("div",de,[t(i,{label:"Atras",color:"primary",onClick:e[0]||(e[0]=a=>o.$router.push("/compras")),"no-caps":"",icon:"arrow_back",dense:"",size:"10px"})]),l("div",ue,[t(y,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(x,null,{default:r(()=>[t(q,{modelValue:G(m),"onUpdate:modelValue":[e[1]||(e[1]=a=>Z(m)?m.value=a:m=a),I],label:"Buscar producto",outlined:"",dense:"",debounce:"300"},null,8,["modelValue"]),t(ee,{bordered:"",padding:"",dense:""},{default:r(()=>[(s(!0),f(_,null,w(k.value,a=>(s(),f(_,{key:a.id},[h((s(),Q(ae,{clickable:"",onClick:d=>N(a)},{default:r(()=>[t(U,null,{default:r(()=>[t($,null,{default:r(()=>[b(c(a.nombre)+" ",1),l("span",ie," ("+c(a.agencia)+") ",1)]),_:2},1024),t($,{caption:""},{default:r(()=>[a.producto_combo.length>0?(s(),f("span",ce,[(s(!0),f(_,null,w(a.producto_combo,d=>(s(),Q(le,{key:d.id,label:d.cantidad+" "+d.producto_hijo.nombre,dense:""},null,8,["label"]))),128))])):H("",!0),b(" "+c(a.precio)+" Bs ",1)]),_:2},1024)]),_:2},1024),t(U,{side:""},{default:r(()=>[t($,{caption:""},{default:r(()=>[e[6]||(e[6]=b("Stock ")),e[7]||(e[7]=l("br",null,null,-1)),b(" "+c(a.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[J]]),t(K,{spaced:"",inset:""})],64))),128))]),_:1})]),_:1})]),_:1})]),l("div",pe,[t(y,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(x,null,{default:r(()=>[l("div",me,[l("div",ve,[e[8]||(e[8]=l("div",null,"Carrito",-1)),t(z),t(i,{icon:"delete",color:"red",dense:"",onClick:e[2]||(e[2]=a=>n.value=[]),loading:v.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),e[9]||(e[9]=l("div",{class:"text-caption"},"Productos comprados",-1))]),t(te,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[e[11]||(e[11]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",null,"Producto"),l("th",null,"Cantidad"),l("th",null,"Precio"),l("th",null,"Subtotal")])],-1)),l("tbody",null,[(s(!0),f(_,null,w(n.value,(a,d)=>(s(),f("tr",{key:d},[l("td",null,[l("div",fe,[t(i,{icon:"delete",color:"red",dense:"",onClick:V=>T(d),loading:v.value,size:"10px"},null,8,["onClick","loading"]),b(" "+c(a.nombre),1)])]),l("td",null,[h(l("input",{"onUpdate:modelValue":V=>a.cantidadVenta=V,type:"number",style:{width:"60px"},step:"0.01"},null,8,be),[[S,a.cantidadVenta,void 0,{number:!0}]])]),l("td",null,[h(l("input",{"onUpdate:modelValue":V=>a.precioVenta=V,type:"number",style:{width:"60px"},step:"0.01"},null,8,ge),[[S,a.precioVenta,void 0,{number:!0}]])]),l("td",null,[b(c((a.cantidadVenta*a.precioVenta).toFixed(2))+" Bs ",1),t(i,{icon:"calculate",color:"gray",flat:"",dense:"",onClick:V=>E(a),size:"10px","no-caps":""},null,8,["onClick"])])]))),128))]),l("tfoot",null,[l("tr",null,[e[10]||(e[10]=l("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),l("td",Ce,c(B.value)+" Bs",1)])])]),_:1}),t(i,{label:"Registrar Compra",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:j,loading:v.value},null,8,["loading"])]),_:1})]),_:1})])]),t(X,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=a=>C.value=a)},{default:r(()=>[t(y,{flat:"",bordered:""},{default:r(()=>[t(x,{class:"q-pb-none row items-center"},{default:r(()=>[e[12]||(e[12]=l("div",{class:"text-bold"},"Registrar Compra",-1)),t(z),t(i,{flat:"",dense:"",round:"",icon:"close",onClick:e[3]||(e[3]=a=>C.value=!1)})]),_:1}),t(x,null,{default:r(()=>[t(oe,{onSubmit:Y(A,["prevent"])},{default:r(()=>[t(q,{modelValue:g.value.nombre,"onUpdate:modelValue":e[4]||(e[4]=a=>g.value.nombre=a),label:"Proveedor / Nota",outlined:"",dense:"",rules:[a=>!!a||"Campo requerido"]},null,8,["modelValue","rules"]),t(i,{label:"Registrar Compra",color:"positive",type:"submit","no-caps":"",loading:v.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Pe as default};
