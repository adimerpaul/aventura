import{at as D,g as M,r as u,l as O,x as Z,c as Q,o as s,w as r,b as l,a as t,f as i,Q as y,e as x,ap as q,au as G,u as H,a4 as v,a5 as k,a6 as w,Z as h,a0 as f,t as b,a3 as J,a1 as K,ao as W,b1 as S,h as X,as as Y}from"./index-DmXF2vU7.js";import{d as ee,Q as ae,a as U,b as $,c as le}from"./QList-BmsGfYz3.js";import{Q as z}from"./QSpace-CI6q1rwz.js";import{Q as te}from"./QMarkupTable-aS8TMezk.js";import{Q as oe}from"./QForm-CuTfOJli.js";import{Q as re}from"./QPage-DGqXvlAa.js";import{u as ne}from"./use-quasar-B3j39DKS.js";const se={class:"row"},de={class:"col-12"},ue={class:"col-12 col-md-5"},ie={key:0},ce={class:"col-12 col-md-7"},pe={class:"div"},me={class:"text-h6 row items-center"},ve={style:{"wrap-option":"break-word",width:"120px","line-height":"0.8"}},fe=["onUpdate:modelValue"],be=["onUpdate:modelValue"],Ce={class:"text-bold"},he={__name:"CompraAdd",setup(ge){const L=D(),{proxy:c}=M(),C=u({nombre:""}),_=u([]),P=u([]),n=u([]);let p=u("");const g=u(!1),m=u(!1),R=ne();O(()=>{F()});function E(o){R.dialog({title:"Calcular Caja",html:!0,message:`Producto: ${o.nombre} <br> Cantidad: ${o.cantidadVenta}`,prompt:{type:"number",label:"Total de cajas",min:1,max:1e5,required:!0},cancel:!0,ok:{label:"Calcular",color:"primary"}}).onOk(e=>{const a=e/o.cantidadVenta;console.log(a),o.precioVenta=a.toFixed(3)})}function F(){c.$axios.get("/productos").then(o=>{_.value=o.data,P.value=o.data})}const B=Z(()=>n.value.reduce((o,e)=>o+e.cantidadVenta*e.precioVenta,0).toFixed(2));function I(){_.value=P.value.filter(o=>o.nombre.toLowerCase().includes(p.value.toLowerCase()))}function N(o){const e=n.value.find(a=>a.id===o.id);e?e.cantidadVenta++:n.value.push({...o,cantidadVenta:1,precioVenta:o.precio})}function T(o){n.value.splice(o,1)}function j(){if(n.value.length===0){c.$alert.error("El carrito está vacío","Error");return}g.value=!0,C.value={nombre:"Proveedor"}}function A(){if(n.value.length===0){c.$alert.error("El carrito está vacío");return}m.value=!0,c.$axios.post("/compras",{...C.value,total:B.value,productos:n.value}).then(async()=>{n.value=[],C.value={nombre:""},g.value=!1,c.$alert.success("Compra registrada con éxito","Éxito"),L.push("/compras"),p.value=""}).catch(o=>{c.$alert.error(o.response.data.message,"Error")}).finally(()=>{m.value=!1})}return(o,e)=>(s(),Q(re,{class:"q-pa-xs"},{default:r(()=>[l("div",se,[l("div",de,[t(i,{label:"Atras",color:"primary",onClick:e[0]||(e[0]=a=>o.$router.push("/compras")),"no-caps":"",icon:"arrow_back",dense:"",size:"10px"})]),l("div",ue,[t(y,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(x,null,{default:r(()=>[t(q,{modelValue:H(p),"onUpdate:modelValue":[e[1]||(e[1]=a=>G(p)?p.value=a:p=a),I],label:"Buscar producto",outlined:"",dense:"",debounce:"300"},null,8,["modelValue"]),t(ee,{bordered:"",padding:"",dense:""},{default:r(()=>[(s(!0),v(k,null,w(_.value,a=>(s(),v(k,{key:a.id},[h((s(),Q(ae,{clickable:"",onClick:d=>N(a)},{default:r(()=>[t(U,null,{default:r(()=>[t($,null,{default:r(()=>[f(b(a.nombre),1)]),_:2},1024),t($,{caption:""},{default:r(()=>[a.producto_combo.length>0?(s(),v("span",ie,[(s(!0),v(k,null,w(a.producto_combo,d=>(s(),Q(le,{key:d.id,label:d.cantidad+" "+d.producto_hijo.nombre,dense:""},null,8,["label"]))),128))])):J("",!0),f(" "+b(a.precio)+" Bs ",1)]),_:2},1024)]),_:2},1024),t(U,{side:""},{default:r(()=>[t($,{caption:""},{default:r(()=>[e[6]||(e[6]=f("Stock ")),e[7]||(e[7]=l("br",null,null,-1)),f(" "+b(a.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[K]]),t(W,{spaced:"",inset:""})],64))),128))]),_:1})]),_:1})]),_:1})]),l("div",ce,[t(y,{flat:"",bordered:"",class:"q-ma-xs"},{default:r(()=>[t(x,null,{default:r(()=>[l("div",pe,[l("div",me,[e[8]||(e[8]=l("div",null,"Carrito",-1)),t(z),t(i,{icon:"delete",color:"red",dense:"",onClick:e[2]||(e[2]=a=>n.value=[]),loading:m.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),e[9]||(e[9]=l("div",{class:"text-caption"},"Productos comprados",-1))]),t(te,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[e[11]||(e[11]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",null,"Producto"),l("th",null,"Cantidad"),l("th",null,"Precio"),l("th",null,"Subtotal")])],-1)),l("tbody",null,[(s(!0),v(k,null,w(n.value,(a,d)=>(s(),v("tr",{key:d},[l("td",null,[l("div",ve,[t(i,{icon:"delete",color:"red",dense:"",onClick:V=>T(d),loading:m.value,size:"10px"},null,8,["onClick","loading"]),f(" "+b(a.nombre),1)])]),l("td",null,[h(l("input",{"onUpdate:modelValue":V=>a.cantidadVenta=V,type:"number",style:{width:"60px"},step:"0.01"},null,8,fe),[[S,a.cantidadVenta,void 0,{number:!0}]])]),l("td",null,[h(l("input",{"onUpdate:modelValue":V=>a.precioVenta=V,type:"number",style:{width:"60px"},step:"0.01"},null,8,be),[[S,a.precioVenta,void 0,{number:!0}]])]),l("td",null,[f(b((a.cantidadVenta*a.precioVenta).toFixed(2))+" Bs ",1),t(i,{icon:"calculate",color:"gray",flat:"",dense:"",onClick:V=>E(a),size:"10px","no-caps":""},null,8,["onClick"])])]))),128))]),l("tfoot",null,[l("tr",null,[e[10]||(e[10]=l("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),l("td",Ce,b(B.value)+" Bs",1)])])]),_:1}),t(i,{label:"Registrar Compra",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:j,loading:m.value},null,8,["loading"])]),_:1})]),_:1})])]),t(X,{modelValue:g.value,"onUpdate:modelValue":e[5]||(e[5]=a=>g.value=a)},{default:r(()=>[t(y,{flat:"",bordered:""},{default:r(()=>[t(x,{class:"q-pb-none row items-center"},{default:r(()=>[e[12]||(e[12]=l("div",{class:"text-bold"},"Registrar Compra",-1)),t(z),t(i,{flat:"",dense:"",round:"",icon:"close",onClick:e[3]||(e[3]=a=>g.value=!1)})]),_:1}),t(x,null,{default:r(()=>[t(oe,{onSubmit:Y(A,["prevent"])},{default:r(()=>[t(q,{modelValue:C.value.nombre,"onUpdate:modelValue":e[4]||(e[4]=a=>C.value.nombre=a),label:"Proveedor / Nota",outlined:"",dense:"",rules:[a=>!!a||"Campo requerido"]},null,8,["modelValue","rules"]),t(i,{label:"Registrar Compra",color:"positive",type:"submit","no-caps":"",loading:m.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{he as default};
