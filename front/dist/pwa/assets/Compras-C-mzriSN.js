import{g as U,r as u,l as N,c as i,o as s,w as t,a as o,b as e,Q as C,e as Q,as as q,ap as y,a3 as b,f as k,a4 as x,a5 as E,a6 as P,Z as V,d as w,a0 as I,t as d}from"./index-DmXF2vU7.js";import{Q as L}from"./QSelect-B9TjULO2.js";import{Q as z}from"./QForm-CuTfOJli.js";import{d as O,Q as F,a as h,c as Z}from"./QList-BmsGfYz3.js";import{Q as j}from"./QBtnDropdown-B7sybCpT.js";import{Q as G}from"./QMarkupTable-aS8TMezk.js";import{Q as H}from"./QPage-DGqXvlAa.js";import{C as $}from"./ClosePopup-BlYqTcW6.js";import{h as A}from"./moment-C5S46NFB.js";import{I as D}from"./impresion-BcmyQcBB.js";import"./format-Chq1_pav.js";import"./QBtnGroup-DgLFrh7G.js";const J={class:"row q-col-gutter-sm"},K={class:"col-12 col-md-2"},R={class:"col-12 col-md-2"},W={class:"col-12 col-md-2"},X={class:"col-12 col-md-2 flex flex-center"},ee={class:"col-12 col-md-2"},le={class:"col-12 col-md-2"},ae={style:{"wrap-option":"break-word",width:"200px","line-height":"0.8"}},he={__name:"Compras",setup(oe){const{proxy:m}=U(),c=u(A().format("YYYY-MM-DD")),p=u(A().format("YYYY-MM-DD")),g=u([]),r=u(!1),f=u([]),v=u("");N(()=>{T(),_()});function T(){f.value=[{id:"",name:"Todos"}],m.$axios.get("/usersSucursal").then(n=>{n.data.forEach(l=>{f.value.push({id:l.id,name:l.name})})})}function _(){r.value=!0,m.$axios.get("/compras",{params:{fechaInicio:c.value,fechaFin:p.value,user_id:v.value}}).then(n=>{g.value=n.data}).finally(()=>{r.value=!1})}function Y(n){m.$q.dialog({title:"Anular Compra",message:"¿Está seguro de anular la compra?",ok:"Sí",cancel:"No"}).onOk(()=>{r.value=!0,m.$axios.put(`/compras/${n}/anular`).then(()=>{_()}).finally(()=>{r.value=!1})})}function B(){const n=f.value.find(a=>a.id===v.value)?.name||"Todos",l=g.value.filter(a=>!a.anulada);D.imprimirComprasTotales(l,c.value,p.value,n)}function M(n){const l=n.user?.name||"";D.imprimirCompraUnica(n,l)}return(n,l)=>(s(),i(H,{class:"q-pa-xs"},{default:t(()=>[o(C,{flat:"",bordered:""},{default:t(()=>[o(Q,{class:"q-pa-xs"},{default:t(()=>[o(z,{onSubmit:q(_,["prevent"])},{default:t(()=>[e("div",J,[e("div",K,[o(y,{modelValue:c.value,"onUpdate:modelValue":l[0]||(l[0]=a=>c.value=a),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",R,[o(y,{modelValue:p.value,"onUpdate:modelValue":l[1]||(l[1]=a=>p.value=a),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",W,[n.$store.user.role==="Admin"?(s(),i(L,{key:0,modelValue:v.value,"onUpdate:modelValue":l[2]||(l[2]=a=>v.value=a),label:"Usuario",outlined:"",dense:"",options:f.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):b("",!0)]),e("div",X,[o(k,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:r.value},null,8,["loading"])]),e("div",ee,[o(k,{label:"Nueva Compra",color:"positive",icon:"add_circle_outline","no-caps":"",onClick:l[3]||(l[3]=a=>n.$router.push("/compras/add")),loading:r.value},null,8,["loading"])]),e("div",le,[n.$store.user.role==="Admin"?(s(),i(k,{key:0,label:"Imprimir",color:"indigo",icon:"print","no-caps":"",onClick:B})):b("",!0)])])]),_:1})]),_:1})]),_:1}),o(C,{flat:"",bordered:"",class:"q-mt-md"},{default:t(()=>[o(Q,null,{default:t(()=>[o(G,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:t(()=>[l[6]||(l[6]=e("thead",null,[e("tr",{class:"bg-green text-white"},[e("th",null,"Acciones"),e("th",null,"Fecha"),e("th",null,"Total"),e("th",null,"Detalle"),e("th",null,"Proveedor"),e("th",null,"Usuario"),e("th",null,"Agencia")])],-1)),e("tbody",null,[(s(!0),x(E,null,P(g.value,a=>(s(),x("tr",{key:a.id},[e("td",null,[a.anulada?(s(),i(Z,{key:1,color:"red","text-color":"white",label:"Anulada"})):(s(),i(j,{key:0,color:"primary",dense:"",size:"10px",label:"Acciones","no-caps":""},{default:t(()=>[o(O,null,{default:t(()=>[a.anulada?b("",!0):V((s(),i(F,{key:0,clickable:"",onClick:S=>Y(a.id)},{default:t(()=>[o(h,{avatar:""},{default:t(()=>[o(w,{name:"cancel",color:"negative"})]),_:1}),o(h,null,{default:t(()=>l[4]||(l[4]=[I(" Anular ")])),_:1})]),_:2},1032,["onClick"])),[[$]]),V((s(),i(F,{clickable:"",onClick:S=>M(a)},{default:t(()=>[o(h,{avatar:""},{default:t(()=>[o(w,{name:"print",color:"indigo"})]),_:1}),o(h,null,{default:t(()=>l[5]||(l[5]=[I(" Imprimir ")])),_:1})]),_:2},1032,["onClick"])),[[$]])]),_:2},1024)]),_:2},1024))]),e("td",null,d(a.fecha),1),e("td",null,d(a.total),1),e("td",null,[e("div",ae,d(a.detalleText),1)]),e("td",null,d(a.nombre),1),e("td",null,d(a.user?.username),1),e("td",null,d(a.agencia),1)]))),128))])]),_:1})]),_:1})]),_:1}),l[7]||(l[7]=e("div",{id:"myElement",class:"hidden"},null,-1))]),_:1}))}};export{he as default};
