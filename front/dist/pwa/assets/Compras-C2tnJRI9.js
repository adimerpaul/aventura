import{g as J,r as i,l as K,x as Q,c as u,o as s,w as e,a,b as o,Q as Y,e as O,as as W,ap as U,a3 as _,f as N,Z as g,d as w,a0 as m,a4 as F,a2 as q,t as r,a1 as P,a5 as G,a6 as X,u as E}from"./index-CZ4ZY1DO.js";import{Q as aa}from"./QSelect-BTdcDwpU.js";import{d as h,Q as p,a as d,b as f,c as ea}from"./QList-BzK4wMrU.js";import{Q as R}from"./QBtnDropdown-DjUyePpj.js";import{Q as la}from"./QForm-BgSozSfx.js";import{Q as ta}from"./QMarkupTable-DYxCZhAJ.js";import{Q as oa}from"./QPage-J3mg8W0A.js";import{C as A}from"./ClosePopup-Bd_SN24_.js";import{h as I}from"./moment-C5S46NFB.js";import{I as B}from"./impresion-saVdGYuo.js";import"./format-Ci6dt8M_.js";import"./QBtnGroup-Y4_VEv82.js";const na={class:"row q-col-gutter-sm"},sa={class:"col-12 col-md-2"},da={class:"col-12 col-md-2"},ua={class:"col-12 col-md-2"},ia={class:"col-12 col-md-2 flex flex-center"},ra={class:"col-12 col-md-2"},ca={class:"col-12 col-md-2"},ma={class:"row q-mt-md"},pa={class:"col-12 col-md-3 q-pa-xs"},fa={class:"text-weight-bold"},va={class:"col-12 col-md-3 q-pa-xs"},_a={class:"text-weight-bold"},ga={class:"col-12 col-md-3 q-pa-xs"},ha={class:"text-weight-bold"},ba={key:0,class:"col-12 col-md-3 q-pa-xs"},ka={class:"text-weight-bold"},ya={style:{"wrap-option":"break-word",width:"200px","line-height":"0.8"}},Ma={__name:"Compras",setup(xa){const{proxy:C}=J(),b=i(I().format("YYYY-MM-DD")),k=i(I().format("YYYY-MM-DD")),c=i([]),v=i(!1),y=i([]),x=i(""),T=i(0),D=i(0),M=i([]),S=i([]);K(()=>{L(),V()});function L(){y.value=[{id:"",name:"Todos"}],C.$axios.get("/usersSucursal").then(t=>{t.data.forEach(l=>{y.value.push({id:l.id,name:l.name})})})}function V(){v.value=!0,C.$axios.get("/compras",{params:{fechaInicio:b.value,fechaFin:k.value,user_id:x.value}}).then(t=>{c.value=t.data.compras,T.value=t.data.gananciaOquendo,D.value=t.data.gananciaAyacucho,M.value=t.data.ventasAyacucho,S.value=t.data.ventasOquendo}).finally(()=>{v.value=!1})}function z(t){C.$q.dialog({title:"Anular Compra",message:"¿Está seguro de anular la compra?",ok:"Sí",cancel:"No"}).onOk(()=>{v.value=!0,C.$axios.put(`/compras/${t}/anular`).then(()=>{V()}).finally(()=>{v.value=!1})})}function Z(){const t=y.value.find(l=>l.id===x.value)?.name||"Todos";B.imprimirReporteGananciasPorProducto(M.value,S.value,b.value,k.value,t)}function j(){const t=y.value.find(n=>n.id===x.value)?.name||"Todos",l=c.value.filter(n=>!n.anulada);B.imprimirComprasTotales(l,b.value,k.value,t)}function H(t){const l=t.user?.name||"";B.imprimirCompraUnica(t,l)}return Q(()=>c.value.filter(t=>!t.anulada).reduce((t,l)=>t+parseFloat(l.total),0)),Q(()=>c.value.filter(t=>t.anulada).reduce((t,l)=>t+parseFloat(l.total),0)),Q(()=>c.value.filter(t=>!t.anulada).length),Q(()=>c.value.filter(t=>t.anulada).length),(t,l)=>(s(),u(oa,{class:"q-pa-xs"},{default:e(()=>[a(Y,{flat:"",bordered:""},{default:e(()=>[a(O,{class:"q-pa-xs"},{default:e(()=>[a(la,{onSubmit:W(V,["prevent"])},{default:e(()=>[o("div",na,[o("div",sa,[a(U,{modelValue:b.value,"onUpdate:modelValue":l[0]||(l[0]=n=>b.value=n),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",da,[a(U,{modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=n=>k.value=n),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),o("div",ua,[t.$store.user.role==="Admin"?(s(),u(aa,{key:0,modelValue:x.value,"onUpdate:modelValue":l[2]||(l[2]=n=>x.value=n),label:"Usuario",outlined:"",dense:"",options:y.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):_("",!0)]),o("div",ia,[a(N,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:v.value},null,8,["loading"])]),o("div",ra,[a(N,{label:"Nueva Compra",color:"positive",icon:"add_circle_outline","no-caps":"",onClick:l[3]||(l[3]=n=>t.$router.push("/compras/add")),loading:v.value},null,8,["loading"])]),o("div",ca,[t.$store.user.role==="Admin"?(s(),u(R,{key:0,color:"indigo",icon:"print","no-caps":"",label:"Imprimir"},{default:e(()=>[a(h,null,{default:e(()=>[g((s(),u(p,{clickable:"",onClick:j},{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(w,{name:"print"})]),_:1}),a(d,null,{default:e(()=>l[4]||(l[4]=[m(" Imprimir Totales ")])),_:1})]),_:1})),[[A]]),g((s(),u(p,{clickable:"",onClick:Z},{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(w,{name:"bar_chart"})]),_:1}),a(d,null,{default:e(()=>l[5]||(l[5]=[m(" Reporte Ganancias por Producto ")])),_:1})]),_:1})),[[A]])]),_:1})]),_:1})):_("",!0)])])]),_:1})]),_:1})]),_:1}),a(Y,{flat:"",bordered:"",class:"q-mt-md"},{default:e(()=>[o("div",ma,[o("div",pa,[a(h,{bordered:"",padding:"",dense:""},{default:e(()=>[a(p,null,{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(q,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),a(d,null,{default:e(()=>[a(f,null,{default:e(()=>[o("span",fa,r(c.value.length)+" compras",1)]),_:1}),a(f,{caption:""},{default:e(()=>l[6]||(l[6]=[m("Cantidad total de compras")])),_:1})]),_:1})]),_:1})]),_:1})]),o("div",va,[a(h,{bordered:"",padding:"",dense:""},{default:e(()=>[a(p,null,{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(q,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),a(d,null,{default:e(()=>[a(f,null,{default:e(()=>[o("span",_a," Bs "+r(c.value.filter(n=>!n.anulada).reduce((n,$)=>n+parseFloat($.total),0).toFixed(2)),1)]),_:1}),a(f,{caption:""},{default:e(()=>l[7]||(l[7]=[m("Monto total gastado")])),_:1})]),_:1})]),_:1})]),_:1})]),o("div",ga,[t.$store.user.sucursal==="Ayacucho"?(s(),u(h,{key:0,bordered:"",padding:"",dense:""},{default:e(()=>[g((s(),u(p,{clickable:""},{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(q,{color:"amber","text-color":"white",icon:"trending_up"})]),_:1}),a(d,null,{default:e(()=>[a(f,{lines:"1"},{default:e(()=>[o("span",ha," Bs "+r(D.value.toFixed(2)),1)]),_:1}),a(f,{caption:"",lines:"2"},{default:e(()=>l[8]||(l[8]=[m(" Ganancia Ayacucho ")])),_:1})]),_:1})]),_:1})),[[P]])]),_:1})):_("",!0)]),t.$store.user.sucursal==="Oquendo"?(s(),F("div",ba,[a(h,{bordered:"",padding:"",dense:""},{default:e(()=>[g((s(),u(p,{clickable:""},{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(q,{color:"amber","text-color":"white",icon:"trending_up"})]),_:1}),a(d,null,{default:e(()=>[a(f,{lines:"1"},{default:e(()=>[o("span",ka," Bs "+r(T.value.toFixed(2)),1)]),_:1}),a(f,{caption:"",lines:"2"},{default:e(()=>l[9]||(l[9]=[m(" Ganancia Oquendo ")])),_:1})]),_:1})]),_:1})),[[P]])]),_:1})])):_("",!0)]),a(O,null,{default:e(()=>[a(ta,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:e(()=>[l[12]||(l[12]=o("thead",null,[o("tr",{class:"bg-green text-white"},[o("th",null,"Acciones"),o("th",null,"Fecha"),o("th",null,"Total"),o("th",null,"Detalle"),o("th",null,"Proveedor"),o("th",null,"Usuario"),o("th",null,"Agencia")])],-1)),o("tbody",null,[(s(!0),F(G,null,X(c.value,n=>(s(),F("tr",{key:n.id},[o("td",null,[n.anulada?(s(),u(ea,{key:1,color:"red","text-color":"white",label:"Anulada"})):(s(),u(R,{key:0,color:"primary",dense:"",size:"10px",label:"Acciones","no-caps":""},{default:e(()=>[a(h,null,{default:e(()=>[E(I)(n.fecha).isSame(E(I)(),"day")?(s(),F(G,{key:0},[n.anulada?_("",!0):g((s(),u(p,{key:0,clickable:"",onClick:$=>z(n.id)},{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(w,{name:"cancel",color:"negative"})]),_:1}),a(d,null,{default:e(()=>l[10]||(l[10]=[m(" Anular ")])),_:1})]),_:2},1032,["onClick"])),[[A]])],64)):_("",!0),g((s(),u(p,{clickable:"",onClick:$=>H(n)},{default:e(()=>[a(d,{avatar:""},{default:e(()=>[a(w,{name:"print",color:"indigo"})]),_:1}),a(d,null,{default:e(()=>l[11]||(l[11]=[m(" Imprimir ")])),_:1})]),_:2},1032,["onClick"])),[[A]])]),_:2},1024)]),_:2},1024))]),o("td",null,r(n.fecha),1),o("td",null,r(n.total),1),o("td",null,[o("div",ya,r(n.detalleText),1)]),o("td",null,r(n.nombre),1),o("td",null,r(n.user?.username),1),o("td",null,r(n.agencia),1)]))),128))])]),_:1})]),_:1})]),_:1}),l[13]||(l[13]=o("div",{id:"myElement",class:"hidden"},null,-1))]),_:1}))}};export{Ma as default};
