import{g as L,r as p,l as P,x as Q,c,o as u,w as l,a as e,b as t,Q as V,e as $,as as z,ap as q,a3 as F,f as I,a2 as w,t as i,a0 as f,a4 as A,a5 as O,a6 as Z,Z as B,d as M}from"./index-DPNgNDZA.js";import{Q as j}from"./QSelect-CcegbZfQ.js";import{Q as G}from"./QForm-CUicyxGw.js";import{d as h,Q as v,a as s,b as r,c as H}from"./QList-i4w7QsLv.js";import{Q as J}from"./QBtnDropdown-BtEQ0P2w.js";import{Q as K}from"./QMarkupTable-PcfD26Ti.js";import{Q as R}from"./QPage-DM39pZUv.js";import{C as D}from"./ClosePopup-Bk1mnKr3.js";import{h as T}from"./moment-C5S46NFB.js";import{I as Y}from"./impresion-UazNtpnb.js";import"./format-mnsSgzCt.js";import"./QBtnGroup-BC8d8Tnt.js";const W={class:"row q-col-gutter-sm"},X={class:"col-12 col-md-2"},ee={class:"col-12 col-md-2"},le={class:"col-12 col-md-2"},ae={class:"col-12 col-md-2 flex flex-center"},te={class:"col-12 col-md-2"},oe={class:"col-12 col-md-2"},ne={class:"row q-mt-md"},se={class:"col-12 col-md-3 q-pa-xs"},de={class:"text-weight-bold"},ie={class:"col-12 col-md-3 q-pa-xs"},ue={class:"text-weight-bold"},re={class:"col-12 col-md-3 q-pa-xs"},ce={class:"text-weight-bold"},me={class:"col-12 col-md-3 q-pa-xs"},pe={class:"text-weight-bold"},fe={style:{"wrap-option":"break-word",width:"200px","line-height":"0.8"}},Ve={__name:"Compras",setup(ve){const{proxy:g}=L(),b=p(T().format("YYYY-MM-DD")),x=p(T().format("YYYY-MM-DD")),d=p([]),m=p(!1),k=p([]),C=p("");P(()=>{S(),y()});function S(){k.value=[{id:"",name:"Todos"}],g.$axios.get("/usersSucursal").then(n=>{n.data.forEach(a=>{k.value.push({id:a.id,name:a.name})})})}function y(){m.value=!0,g.$axios.get("/compras",{params:{fechaInicio:b.value,fechaFin:x.value,user_id:C.value}}).then(n=>{d.value=n.data}).finally(()=>{m.value=!1})}function U(n){g.$q.dialog({title:"Anular Compra",message:"¿Está seguro de anular la compra?",ok:"Sí",cancel:"No"}).onOk(()=>{m.value=!0,g.$axios.put(`/compras/${n}/anular`).then(()=>{y()}).finally(()=>{m.value=!1})})}function N(){const n=k.value.find(o=>o.id===C.value)?.name||"Todos",a=d.value.filter(o=>!o.anulada);Y.imprimirComprasTotales(a,b.value,x.value,n)}function E(n){const a=n.user?.name||"";Y.imprimirCompraUnica(n,a)}return Q(()=>d.value.filter(n=>!n.anulada).reduce((n,a)=>n+parseFloat(a.total),0)),Q(()=>d.value.filter(n=>n.anulada).reduce((n,a)=>n+parseFloat(a.total),0)),Q(()=>d.value.filter(n=>!n.anulada).length),Q(()=>d.value.filter(n=>n.anulada).length),(n,a)=>(u(),c(R,{class:"q-pa-xs"},{default:l(()=>[e(V,{flat:"",bordered:""},{default:l(()=>[e($,{class:"q-pa-xs"},{default:l(()=>[e(G,{onSubmit:z(y,["prevent"])},{default:l(()=>[t("div",W,[t("div",X,[e(q,{modelValue:b.value,"onUpdate:modelValue":a[0]||(a[0]=o=>b.value=o),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),t("div",ee,[e(q,{modelValue:x.value,"onUpdate:modelValue":a[1]||(a[1]=o=>x.value=o),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),t("div",le,[n.$store.user.role==="Admin"?(u(),c(j,{key:0,modelValue:C.value,"onUpdate:modelValue":a[2]||(a[2]=o=>C.value=o),label:"Usuario",outlined:"",dense:"",options:k.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):F("",!0)]),t("div",ae,[e(I,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:m.value},null,8,["loading"])]),t("div",te,[e(I,{label:"Nueva Compra",color:"positive",icon:"add_circle_outline","no-caps":"",onClick:a[3]||(a[3]=o=>n.$router.push("/compras/add")),loading:m.value},null,8,["loading"])]),t("div",oe,[n.$store.user.role==="Admin"?(u(),c(I,{key:0,label:"Imprimir",color:"indigo",icon:"print","no-caps":"",onClick:N})):F("",!0)])])]),_:1})]),_:1})]),_:1}),e(V,{flat:"",bordered:"",class:"q-mt-md"},{default:l(()=>[t("div",ne,[t("div",se,[e(h,{bordered:"",padding:"",dense:""},{default:l(()=>[e(v,null,{default:l(()=>[e(s,{avatar:""},{default:l(()=>[e(w,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),e(s,null,{default:l(()=>[e(r,null,{default:l(()=>[t("span",de,i(d.value.length)+" compras",1)]),_:1}),e(r,{caption:""},{default:l(()=>a[4]||(a[4]=[f("Cantidad total de compras")])),_:1})]),_:1})]),_:1})]),_:1})]),t("div",ie,[e(h,{bordered:"",padding:"",dense:""},{default:l(()=>[e(v,null,{default:l(()=>[e(s,{avatar:""},{default:l(()=>[e(w,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),e(s,null,{default:l(()=>[e(r,null,{default:l(()=>[t("span",ue," Bs "+i(d.value.filter(o=>!o.anulada).reduce((o,_)=>o+parseFloat(_.total),0).toFixed(2)),1)]),_:1}),e(r,{caption:""},{default:l(()=>a[5]||(a[5]=[f("Monto total gastado")])),_:1})]),_:1})]),_:1})]),_:1})]),t("div",re,[e(h,{bordered:"",padding:"",dense:""},{default:l(()=>[e(v,null,{default:l(()=>[e(s,{avatar:""},{default:l(()=>[e(w,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),e(s,null,{default:l(()=>[e(r,null,{default:l(()=>[t("span",ce," Bs "+i(d.value.filter(o=>o.anulada).reduce((o,_)=>o+parseFloat(_.total),0).toFixed(2)),1)]),_:1}),e(r,{caption:""},{default:l(()=>a[6]||(a[6]=[f("Monto total anulado")])),_:1})]),_:1})]),_:1})]),_:1})]),t("div",me,[e(h,{bordered:"",padding:"",dense:""},{default:l(()=>[e(v,null,{default:l(()=>[e(s,{avatar:""},{default:l(()=>[e(w,{color:"blue","text-color":"white",icon:"check_circle"})]),_:1}),e(s,null,{default:l(()=>[e(r,null,{default:l(()=>[t("span",pe,i(d.value.filter(o=>!o.anulada).length)+" válidas ",1)]),_:1}),e(r,{caption:""},{default:l(()=>a[7]||(a[7]=[f("Compras no anuladas")])),_:1})]),_:1})]),_:1})]),_:1})])]),e($,null,{default:l(()=>[e(K,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:l(()=>[a[10]||(a[10]=t("thead",null,[t("tr",{class:"bg-green text-white"},[t("th",null,"Acciones"),t("th",null,"Fecha"),t("th",null,"Total"),t("th",null,"Detalle"),t("th",null,"Proveedor"),t("th",null,"Usuario"),t("th",null,"Agencia")])],-1)),t("tbody",null,[(u(!0),A(O,null,Z(d.value,o=>(u(),A("tr",{key:o.id},[t("td",null,[o.anulada?(u(),c(H,{key:1,color:"red","text-color":"white",label:"Anulada"})):(u(),c(J,{key:0,color:"primary",dense:"",size:"10px",label:"Acciones","no-caps":""},{default:l(()=>[e(h,null,{default:l(()=>[o.anulada?F("",!0):B((u(),c(v,{key:0,clickable:"",onClick:_=>U(o.id)},{default:l(()=>[e(s,{avatar:""},{default:l(()=>[e(M,{name:"cancel",color:"negative"})]),_:1}),e(s,null,{default:l(()=>a[8]||(a[8]=[f(" Anular ")])),_:1})]),_:2},1032,["onClick"])),[[D]]),B((u(),c(v,{clickable:"",onClick:_=>E(o)},{default:l(()=>[e(s,{avatar:""},{default:l(()=>[e(M,{name:"print",color:"indigo"})]),_:1}),e(s,null,{default:l(()=>a[9]||(a[9]=[f(" Imprimir ")])),_:1})]),_:2},1032,["onClick"])),[[D]])]),_:2},1024)]),_:2},1024))]),t("td",null,i(o.fecha),1),t("td",null,i(o.total),1),t("td",null,[t("div",fe,i(o.detalleText),1)]),t("td",null,i(o.nombre),1),t("td",null,i(o.user?.username),1),t("td",null,i(o.agencia),1)]))),128))])]),_:1})]),_:1})]),_:1}),a[11]||(a[11]=t("div",{id:"myElement",class:"hidden"},null,-1))]),_:1}))}};export{Ve as default};
