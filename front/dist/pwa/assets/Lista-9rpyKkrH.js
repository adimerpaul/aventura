import{aA as R,g as E,r as p,l as O,c as f,o as d,w as o,a as t,Q as H,e as G,a4 as v,a3 as B,b as e,ap as z,f as D,Z as x,a2 as b,t as n,a0 as h,a1 as g,a5 as P,a6 as Z}from"./index-C0GdddDl.js";import{Q as Y}from"./QSelect-Bvgl3oGJ.js";import{Q as j}from"./QForm-Db3Dwb6S.js";import{c as w,Q as k,a as r,b as u}from"./QList-CBynu25I.js";import{Q as J}from"./QBtnGroup-6ROSH9sr.js";import{Q as K}from"./QChip-DQZ8-ybS.js";import{Q as W}from"./QMarkupTable-CtyPJv_t.js";import{Q as X}from"./QPage-BUBbswOB.js";import{h as q}from"./moment-C5S46NFB.js";import"./format-DyAZJsfq.js";const ee={class:"row"},le={class:"col-6 col-md-2"},te={class:"col-6 col-md-2"},oe={class:"col-6 col-md-2"},ae={class:"col-6 col-md-2"},se={class:"col-12 col-md-2 flex flex-center"},ne={class:"col-12 col-md-12 q-pa-xs"},de={key:0,class:"row"},ie={class:"col-6 col-md-2 q-pa-xs"},re={class:"text-weight-bold"},ue={class:"col-6 col-md-2 q-pa-xs"},ce={class:"text-weight-bold"},pe={class:"col-6 col-md-2 q-pa-xs"},fe={class:"text-weight-bold"},me={class:"col-6 col-md-2 q-pa-xs"},_e={class:"text-weight-bold"},he={class:"col-6 col-md-2 q-pa-xs"},ve={class:"text-weight-bold"},xe={key:1,class:"text-green text-bold text-center"},be={key:2,class:"text-red text-bold text-center"},ge={style:{"font-size":"10px"}},we={class:"text-right"},ke={class:"text-right"},Fe={class:"text-right"},ye={class:"text-right"},Qe={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Ce={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Ue={__name:"Lista",setup(Ve){const I=R(),{proxy:c}=E(),F=p(q().format("YYYY-MM-DD")),y=p(q().format("YYYY-MM-DD")),m=p([]),S=p([]),_=p(!1),Q=p(""),C=p([]),V=p(0),A=p("Todo");O(()=>{$(),U()});function U(){C.value=[{id:0,name:"Todos"}],c.$axios.get("users").then(s=>{s.data.forEach(a=>{C.value.push(a)})}).catch(s=>{console.log(s)})}function L(){m.value=S.value.filter(s=>s.nombre.toLowerCase().includes(Q.value.toLowerCase()))}function M(s){const a=parseFloat(s.adelanto).toFixed(2),l=parseFloat(s.total).toFixed(2),i=parseFloat(s.total-s.adelanto).toFixed(2);c.$alert.dialogConfirm('<span style="color: blue;font-size: 20px;font-weight: bold">¿Desea confirmar la reserva? <br> </span>Total: '+l+"<br>Adelanto: "+a+'<br><span style="color: red;font-size: 20px;font-weight: bold">Saldo: '+i+" Bs</span>").onOk(()=>{_.value=!0,c.$axios.post("reservasConfirmar",{id:s.id}).then(T=>{c.$socket.emit("reservas"),I.push("/reservas")}).catch(T=>{c.$alert.error(T.response.data.message,"Error"),_.value=!1})})}function N(s){c.$alert.dialogAnular('<span style="color: red;font-size: 20px;font-weight: bold">¿Desea anular la reserva?</span>').onOk(()=>{_.value=!0,c.$axios.post("reservasAnular",{id:s}).then(a=>{c.$socket.emit("reservas"),$()}).catch(a=>{console.log(a)})})}function $(){_.value=!0,c.$axios.get("reservasAll",{params:{fechaInicio:F.value,fechaFin:y.value,user_id:V.value,tipo:A.value}}).then(s=>{m.value=s.data,S.value=s.data}).catch(s=>{console.log(s)}).finally(()=>{_.value=!1})}return(s,a)=>(d(),f(X,{class:"q-pa-xs"},{default:o(()=>[t(H,{flat:"",bordered:""},{default:o(()=>[t(G,{class:"q-pa-xs"},{default:o(()=>[t(j,{onSubmit:$},{default:o(()=>[e("div",ee,[e("div",le,[t(z,{modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=l=>F.value=l),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",te,[t(z,{modelValue:y.value,"onUpdate:modelValue":a[1]||(a[1]=l=>y.value=l),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",oe,[s.$store.user.role==="Admin"?(d(),f(Y,{key:0,modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=l=>V.value=l),label:"Usuario",outlined:"",dense:"",options:C.value,"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["modelValue","options"])):B("",!0)]),e("div",ae,[s.$store.user.role==="Admin"?(d(),f(Y,{key:0,modelValue:A.value,"onUpdate:modelValue":a[3]||(a[3]=l=>A.value=l),label:"Tipo",outlined:"",dense:"",options:["Todo","Adelanto","Confirmado"]},null,8,["modelValue"])):B("",!0)]),e("div",se,[t(D,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:_.value},null,8,["loading"])]),e("div",ne,[t(z,{modelValue:Q.value,"onUpdate:modelValue":[a[4]||(a[4]=l=>Q.value=l),L],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])])])]),_:1}),s.$store.user.role==="Admin"?(d(),v("div",de,[e("div",ie,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(b,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",re,n(m.value.length)+" reservas ",1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[5]||(a[5]=[h(" Cantidad ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",ue,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(b,{color:"orange","text-color":"white",icon:"attach_money"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",ce," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.adelanto),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[6]||(a[6]=[h(" Adelanto ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",pe,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(b,{color:"blue","text-color":"white",icon:"attach_money"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",fe," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.saldo),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[7]||(a[7]=[h(" Saldo ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",me,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(b,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",_e," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[8]||(a[8]=[h(" Total ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",he,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(b,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",ve," Bs "+n(m.value.filter(l=>l.estado==="Cancelado").reduce((l,i)=>l+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[9]||(a[9]=[h(" Anulados ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})])])):B("",!0),t(W,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[a[12]||(a[12]=e("thead",null,[e("tr",{class:"bg-green text-white"},[e("th",null,"Opcion"),e("th",null,"Nombre"),e("th",null,"Sala"),e("th",null,"Fecha"),e("th",null,"Hora"),e("th",null,"Total"),e("th",null,"Adelanto"),e("th",null,"Saldo"),e("th",null,"Estado"),e("th",null,"Observaciones"),e("th",null,"Adelanto"),e("th",null,"Confirmado")])],-1)),e("tbody",null,[(d(!0),v(P,null,Z(m.value,l=>(d(),v("tr",{key:l.id},[e("td",null,[l.estado==="Reservado"?(d(),f(J,{key:0},{default:o(()=>[t(D,{dense:"",label:"Anular",color:"red",icon:"delete","no-caps":"",onClick:i=>N(l.id),size:"10px",loading:_.value},null,8,["onClick","loading"]),t(D,{dense:"",label:"Confirmar",color:"blue",icon:"check","no-caps":"",onClick:i=>M(l),size:"10px",loading:_.value},null,8,["onClick","loading"])]),_:2},1024)):l.estado==="Finalizado"?(d(),v("div",xe," Finalizado ")):(d(),v("div",be,[a[10]||(a[10]=h(" Anulado ")),a[11]||(a[11]=e("br",null,null,-1)),e("div",ge,n(l.user_cancelado?.name),1)]))]),e("td",null,n(l.nombre),1),e("td",null,n(l.sala),1),e("td",null,n(s.$filters.dateDmYHis(l.fecha_creacion)),1),e("td",we,n(l.horario),1),e("td",ke,n(l.total),1),e("td",Fe,n(l.adelanto),1),e("td",ye,n(l.total-l.adelanto),1),e("td",null,[t(K,{color:l.color,dense:"",size:"10px"},{default:o(()=>[h(n(l.estado),1)]),_:2},1032,["color"])]),e("td",null,n(l.observaciones),1),e("td",null,[e("div",Qe,n(l.user?.username),1)]),e("td",null,[e("div",Ce,n(l.user_confirmado?.username),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Ue as default};
