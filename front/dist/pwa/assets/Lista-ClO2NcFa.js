import{aA as R,g as E,r,l as H,c as u,o as d,w as t,a as o,Q as G,e as P,a4 as v,a3 as y,b as e,ap as T,f as q,Z as b,a2 as x,t as n,a0 as h,a1 as g,a5 as Z,a6 as j}from"./index-BvRUMRUN.js";import{Q as D}from"./QSelect-Cf6c2F-B.js";import{Q as J}from"./QForm-BMr6GQUg.js";import{d as w,a as k,b as c,c as p,Q as K}from"./QList-CcOq6OXg.js";import{Q as W}from"./QBtnGroup-BEQlsQrw.js";import{Q as X}from"./QMarkupTable-BgEekT3a.js";import{Q as ee}from"./QPage-Dz7VzjdN.js";import{h as I}from"./moment-C5S46NFB.js";import"./format-D5VvgqoI.js";const le={class:"row"},oe={class:"col-6 col-md-2"},te={class:"col-6 col-md-2"},ae={class:"col-6 col-md-2"},se={class:"col-6 col-md-2"},ne={class:"col-6 col-md-2"},de={class:"col-12 col-md-2 flex flex-center"},ie={class:"col-12 col-md-12 q-pa-xs"},re={key:0,class:"row"},ue={class:"col-6 col-md-2 q-pa-xs"},ce={class:"text-weight-bold"},pe={class:"col-6 col-md-2 q-pa-xs"},fe={class:"text-weight-bold"},me={class:"col-6 col-md-2 q-pa-xs"},_e={class:"text-weight-bold"},he={class:"col-6 col-md-2 q-pa-xs"},ve={class:"text-weight-bold"},be={class:"col-6 col-md-2 q-pa-xs"},xe={class:"text-weight-bold"},ge={key:1,class:"text-green text-bold text-center"},we={key:2,class:"text-red text-bold text-center"},ke={style:{"font-size":"10px"}},ye={class:"text-right"},Fe={class:"text-right"},Ce={class:"text-right"},Qe={class:"text-right"},Ve={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Ae={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},$e={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Me={__name:"Lista",setup(ze){const U=R(),{proxy:f}=E(),F=r(I().format("YYYY-MM-DD")),C=r(I().format("YYYY-MM-DD")),m=r([]),S=r([]),_=r(!1),Q=r(""),V=r([]),A=r(0),$=r("Todo"),z=r("Todo");H(()=>{B(),L()});function L(){V.value=[{id:0,name:"Todos"}],f.$axios.get("users").then(s=>{s.data.forEach(a=>{V.value.push(a)})}).catch(s=>{console.log(s)})}function M(){m.value=S.value.filter(s=>s.nombre.toLowerCase().includes(Q.value.toLowerCase()))}function N(s){const a=parseFloat(s.adelanto).toFixed(2),l=parseFloat(s.total).toFixed(2),i=parseFloat(s.total-s.adelanto).toFixed(2);f.$alert.dialogConfirm('<span style="color: blue;font-size: 20px;font-weight: bold">¿Desea confirmar la reserva? <br> </span>Total: '+l+"<br>Adelanto: "+a+'<br><span style="color: red;font-size: 20px;font-weight: bold">Saldo: '+i+" Bs</span>").onOk(()=>{_.value=!0,f.$axios.post("reservasConfirmar",{id:s.id}).then(Y=>{f.$socket.emit("reservas"),U.push("/reservas")}).catch(Y=>{f.$alert.error(Y.response.data.message,"Error"),_.value=!1})})}function O(s){f.$alert.dialogAnular('<span style="color: red;font-size: 20px;font-weight: bold">¿Desea anular la reserva?</span>').onOk(()=>{_.value=!0,f.$axios.post("reservasAnular",{id:s}).then(a=>{f.$socket.emit("reservas"),B()}).catch(a=>{console.log(a)})})}function B(){_.value=!0,f.$axios.get("reservasAll",{params:{fechaInicio:F.value,fechaFin:C.value,user_id:A.value,tipo:$.value,agencia:z.value}}).then(s=>{m.value=s.data,S.value=s.data}).catch(s=>{console.log(s)}).finally(()=>{_.value=!1})}return(s,a)=>(d(),u(ee,{class:"q-pa-xs"},{default:t(()=>[o(G,{flat:"",bordered:""},{default:t(()=>[o(P,{class:"q-pa-xs"},{default:t(()=>[o(J,{onSubmit:B},{default:t(()=>[e("div",le,[e("div",oe,[o(T,{modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=l=>F.value=l),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",te,[o(T,{modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=l=>C.value=l),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",ae,[s.$store.user.role==="Admin"?(d(),u(D,{key:0,modelValue:A.value,"onUpdate:modelValue":a[2]||(a[2]=l=>A.value=l),label:"Usuario",outlined:"",dense:"",options:V.value,"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["modelValue","options"])):y("",!0)]),e("div",se,[s.$store.user.role==="Admin"?(d(),u(D,{key:0,modelValue:$.value,"onUpdate:modelValue":a[3]||(a[3]=l=>$.value=l),label:"Tipo",outlined:"",dense:"",options:["Todo","Adelanto","Confirmado"]},null,8,["modelValue"])):y("",!0)]),e("div",ne,[s.$store.user.role==="Admin"?(d(),u(D,{key:0,modelValue:z.value,"onUpdate:modelValue":a[4]||(a[4]=l=>z.value=l),label:"Agencia",outlined:"",dense:"",options:["Todo","Ayacucho","Oquendo"]},null,8,["modelValue"])):y("",!0)]),e("div",de,[o(q,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:_.value},null,8,["loading"])]),e("div",ie,[o(T,{modelValue:Q.value,"onUpdate:modelValue":[a[5]||(a[5]=l=>Q.value=l),M],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])])])]),_:1}),s.$store.user.role==="Admin"?(d(),v("div",re,[e("div",ue,[o(w,{bordered:"",padding:"",dense:""},{default:t(()=>[b((d(),u(k,{clickable:"",dense:""},{default:t(()=>[o(c,{avatar:""},{default:t(()=>[o(x,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),o(c,null,{default:t(()=>[o(p,{lines:"1"},{default:t(()=>[e("span",ce,n(m.value.length)+" reservas ",1)]),_:1}),o(p,{caption:"",lines:"2"},{default:t(()=>a[6]||(a[6]=[h(" Cantidad ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",pe,[o(w,{bordered:"",padding:"",dense:""},{default:t(()=>[b((d(),u(k,{clickable:"",dense:""},{default:t(()=>[o(c,{avatar:""},{default:t(()=>[o(x,{color:"orange","text-color":"white",icon:"attach_money"})]),_:1}),o(c,null,{default:t(()=>[o(p,{lines:"1"},{default:t(()=>[e("span",fe," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.adelanto),0).toFixed(2)),1)]),_:1}),o(p,{caption:"",lines:"2"},{default:t(()=>a[7]||(a[7]=[h(" Adelanto ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",me,[o(w,{bordered:"",padding:"",dense:""},{default:t(()=>[b((d(),u(k,{clickable:"",dense:""},{default:t(()=>[o(c,{avatar:""},{default:t(()=>[o(x,{color:"blue","text-color":"white",icon:"attach_money"})]),_:1}),o(c,null,{default:t(()=>[o(p,{lines:"1"},{default:t(()=>[e("span",_e," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.saldo),0).toFixed(2)),1)]),_:1}),o(p,{caption:"",lines:"2"},{default:t(()=>a[8]||(a[8]=[h(" Saldo ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",he,[o(w,{bordered:"",padding:"",dense:""},{default:t(()=>[b((d(),u(k,{clickable:"",dense:""},{default:t(()=>[o(c,{avatar:""},{default:t(()=>[o(x,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),o(c,null,{default:t(()=>[o(p,{lines:"1"},{default:t(()=>[e("span",ve," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),o(p,{caption:"",lines:"2"},{default:t(()=>a[9]||(a[9]=[h(" Total ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",be,[o(w,{bordered:"",padding:"",dense:""},{default:t(()=>[b((d(),u(k,{clickable:"",dense:""},{default:t(()=>[o(c,{avatar:""},{default:t(()=>[o(x,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),o(c,null,{default:t(()=>[o(p,{lines:"1"},{default:t(()=>[e("span",xe," Bs "+n(m.value.filter(l=>l.estado==="Cancelado").reduce((l,i)=>l+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),o(p,{caption:"",lines:"2"},{default:t(()=>a[10]||(a[10]=[h(" Anulados ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})])])):y("",!0),o(X,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:t(()=>[a[13]||(a[13]=e("thead",null,[e("tr",{class:"bg-green text-white"},[e("th",null,"Opcion"),e("th",null,"Nombre"),e("th",null,"Sala"),e("th",null,"Fecha"),e("th",null,"Hora"),e("th",null,"Total"),e("th",null,"Adelanto"),e("th",null,"Saldo"),e("th",null,"Estado"),e("th",null,"Observaciones"),e("th",null,"Adelanto"),e("th",null,"Confirmado"),e("th",null,"Agencia")])],-1)),e("tbody",null,[(d(!0),v(Z,null,j(m.value,l=>(d(),v("tr",{key:l.id},[e("td",null,[l.estado==="Reservado"?(d(),u(W,{key:0},{default:t(()=>[o(q,{dense:"",label:"Anular",color:"red",icon:"delete","no-caps":"",onClick:i=>O(l.id),size:"10px",loading:_.value},null,8,["onClick","loading"]),o(q,{dense:"",label:"Confirmar",color:"blue",icon:"check","no-caps":"",onClick:i=>N(l),size:"10px",loading:_.value},null,8,["onClick","loading"])]),_:2},1024)):l.estado==="Finalizado"?(d(),v("div",ge," Finalizado ")):(d(),v("div",we,[a[11]||(a[11]=h(" Anulado ")),a[12]||(a[12]=e("br",null,null,-1)),e("div",ke,n(l.user_cancelado?.name),1)]))]),e("td",null,n(l.nombre),1),e("td",null,n(l.sala),1),e("td",null,n(s.$filters.dateDmYHis(l.fecha_creacion)),1),e("td",ye,n(l.horario),1),e("td",Fe,n(l.total),1),e("td",Ce,n(l.adelanto),1),e("td",Qe,n(l.total-l.adelanto),1),e("td",null,[o(K,{color:l.color,dense:"",size:"10px"},{default:t(()=>[h(n(l.estado),1)]),_:2},1032,["color"])]),e("td",null,n(l.observaciones),1),e("td",null,[e("div",Ve,n(l.user?.username),1)]),e("td",null,[e("div",Ae,n(l.user_confirmado?.username),1)]),e("td",null,[e("div",$e,n(l.agencia),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Me as default};
