import{aA as R,g as E,r as p,l as N,c as _,o as i,w as o,a as t,Q as O,e as H,b as e,ap as $,f as z,Z as v,a2 as x,t as n,a0 as h,a1 as b,a4 as k,a5 as G,a6 as P}from"./index-DoTxXct_.js";import{Q as T}from"./QSelect-BI1pwFRM.js";import{Q as Z}from"./QForm-BJbwm7rZ.js";import{c as g,Q as w,a as r,b as u}from"./QList-BHfyo9Fm.js";import{Q as j}from"./QBtnGroup-tHkBRKMP.js";import{Q as J}from"./QChip-DHsotkmB.js";import{Q as K}from"./QMarkupTable-LhTg9RbA.js";import{Q as W}from"./QPage-BQRSUEjc.js";import{h as Y}from"./moment-C5S46NFB.js";import"./format-JFtu5K03.js";const X={class:"row"},ee={class:"col-6 col-md-2"},le={class:"col-6 col-md-2"},te={class:"col-6 col-md-2"},oe={class:"col-6 col-md-2"},ae={class:"col-12 col-md-2 flex flex-center"},se={class:"col-12 col-md-12 q-pa-xs"},ne={class:"row"},de={class:"col-6 col-md-2 q-pa-xs"},ie={class:"text-weight-bold"},re={class:"col-6 col-md-2 q-pa-xs"},ue={class:"text-weight-bold"},ce={class:"col-6 col-md-2 q-pa-xs"},pe={class:"text-weight-bold"},fe={class:"col-6 col-md-2 q-pa-xs"},me={class:"text-weight-bold"},_e={class:"col-6 col-md-2 q-pa-xs"},he={class:"text-weight-bold"},ve={key:1,class:"text-green text-bold text-center"},xe={key:2,class:"text-red text-bold text-center"},be={style:{"font-size":"10px"}},ge={class:"text-right"},we={class:"text-right"},ke={class:"text-right"},Fe={class:"text-right"},Qe={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},ye={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Ie={__name:"Lista",setup(Ce){const q=R(),{proxy:c}=E(),F=p(Y().format("YYYY-MM-DD")),Q=p(Y().format("YYYY-MM-DD")),f=p([]),D=p([]),m=p(!1),y=p(""),C=p([]),V=p(0),A=p("Todo");N(()=>{B(),I()});function I(){C.value=[{id:0,name:"Todos"}],c.$axios.get("users").then(s=>{s.data.forEach(a=>{C.value.push(a)})}).catch(s=>{console.log(s)})}function U(){f.value=D.value.filter(s=>s.nombre.toLowerCase().includes(y.value.toLowerCase()))}function L(s){const a=parseFloat(s.adelanto).toFixed(2),l=parseFloat(s.total).toFixed(2),d=parseFloat(s.total-s.adelanto).toFixed(2);c.$alert.dialogConfirm('<span style="color: blue;font-size: 20px;font-weight: bold">¿Desea confirmar la reserva? <br> </span>Total: '+l+"<br>Adelanto: "+a+'<br><span style="color: red;font-size: 20px;font-weight: bold">Saldo: '+d+" Bs</span>").onOk(()=>{m.value=!0,c.$axios.post("reservasConfirmar",{id:s.id}).then(S=>{c.$socket.emit("reservas"),q.push("/reservas")}).catch(S=>{c.$alert.error(S.response.data.message,"Error"),m.value=!1})})}function M(s){c.$alert.dialogAnular('<span style="color: red;font-size: 20px;font-weight: bold">¿Desea anular la reserva?</span>').onOk(()=>{m.value=!0,c.$axios.post("reservasAnular",{id:s}).then(a=>{c.$socket.emit("reservas"),B()}).catch(a=>{console.log(a)})})}function B(){m.value=!0,c.$axios.get("reservasAll",{params:{fechaInicio:F.value,fechaFin:Q.value,user_id:V.value,tipo:A.value}}).then(s=>{f.value=s.data,D.value=s.data}).catch(s=>{console.log(s)}).finally(()=>{m.value=!1})}return(s,a)=>(i(),_(W,{class:"q-pa-xs"},{default:o(()=>[t(O,{flat:"",bordered:""},{default:o(()=>[t(H,{class:"q-pa-xs"},{default:o(()=>[t(Z,{onSubmit:B},{default:o(()=>[e("div",X,[e("div",ee,[t($,{modelValue:F.value,"onUpdate:modelValue":a[0]||(a[0]=l=>F.value=l),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",le,[t($,{modelValue:Q.value,"onUpdate:modelValue":a[1]||(a[1]=l=>Q.value=l),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",te,[t(T,{modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=l=>V.value=l),label:"Usuario",outlined:"",dense:"",options:C.value,"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["modelValue","options"])]),e("div",oe,[t(T,{modelValue:A.value,"onUpdate:modelValue":a[3]||(a[3]=l=>A.value=l),label:"Tipo",outlined:"",dense:"",options:["Todo","Adelanto","Confirmado"]},null,8,["modelValue"])]),e("div",ae,[t(z,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:m.value},null,8,["loading"])]),e("div",se,[t($,{modelValue:y.value,"onUpdate:modelValue":[a[4]||(a[4]=l=>y.value=l),U],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])])])]),_:1}),e("div",ne,[e("div",de,[t(g,{bordered:"",padding:"",dense:""},{default:o(()=>[v((i(),_(w,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(x,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",ie,n(f.value.length)+" reservas ",1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[5]||(a[5]=[h(" Cantidad ")])),_:1})]),_:1})]),_:1})),[[b]])]),_:1})]),e("div",re,[t(g,{bordered:"",padding:"",dense:""},{default:o(()=>[v((i(),_(w,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(x,{color:"orange","text-color":"white",icon:"attach_money"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",ue," Bs "+n(f.value.filter(l=>l.estado!=="Cancelado").reduce((l,d)=>l+parseFloat(d.adelanto),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[6]||(a[6]=[h(" Adelanto ")])),_:1})]),_:1})]),_:1})),[[b]])]),_:1})]),e("div",ce,[t(g,{bordered:"",padding:"",dense:""},{default:o(()=>[v((i(),_(w,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(x,{color:"blue","text-color":"white",icon:"attach_money"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",pe," Bs "+n(f.value.filter(l=>l.estado!=="Cancelado").reduce((l,d)=>l+parseFloat(d.saldo),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[7]||(a[7]=[h(" Saldo ")])),_:1})]),_:1})]),_:1})),[[b]])]),_:1})]),e("div",fe,[t(g,{bordered:"",padding:"",dense:""},{default:o(()=>[v((i(),_(w,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(x,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",me," Bs "+n(f.value.filter(l=>l.estado!=="Cancelado").reduce((l,d)=>l+parseFloat(d.total),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[8]||(a[8]=[h(" Total ")])),_:1})]),_:1})]),_:1})),[[b]])]),_:1})]),e("div",_e,[t(g,{bordered:"",padding:"",dense:""},{default:o(()=>[v((i(),_(w,{clickable:"",dense:""},{default:o(()=>[t(r,{avatar:""},{default:o(()=>[t(x,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),t(r,null,{default:o(()=>[t(u,{lines:"1"},{default:o(()=>[e("span",he," Bs "+n(f.value.filter(l=>l.estado==="Cancelado").reduce((l,d)=>l+parseFloat(d.total),0).toFixed(2)),1)]),_:1}),t(u,{caption:"",lines:"2"},{default:o(()=>a[9]||(a[9]=[h(" Anulados ")])),_:1})]),_:1})]),_:1})),[[b]])]),_:1})])]),t(K,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[a[12]||(a[12]=e("thead",null,[e("tr",null,[e("th",null,"Opcion"),e("th",null,"Nombre"),e("th",null,"Sala"),e("th",null,"Fecha"),e("th",null,"Hora"),e("th",null,"Total"),e("th",null,"Adelanto"),e("th",null,"Saldo"),e("th",null,"Estado"),e("th",null,"Observaciones"),e("th",null,"Adelanto"),e("th",null,"Confirmado")])],-1)),e("tbody",null,[(i(!0),k(G,null,P(f.value,l=>(i(),k("tr",{key:l.id},[e("td",null,[l.estado==="Reservado"?(i(),_(j,{key:0},{default:o(()=>[t(z,{dense:"",label:"Anular",color:"red",icon:"delete","no-caps":"",onClick:d=>M(l.id),size:"10px",loading:m.value},null,8,["onClick","loading"]),t(z,{dense:"",label:"Confirmar",color:"blue",icon:"check","no-caps":"",onClick:d=>L(l),size:"10px",loading:m.value},null,8,["onClick","loading"])]),_:2},1024)):l.estado==="Finalizado"?(i(),k("div",ve," Finalizado ")):(i(),k("div",xe,[a[10]||(a[10]=h(" Anulado ")),a[11]||(a[11]=e("br",null,null,-1)),e("div",be,n(l.user_cancelado?.name),1)]))]),e("td",null,n(l.nombre),1),e("td",null,n(l.sala),1),e("td",null,n(s.$filters.dateDmYHis(l.fecha_creacion)),1),e("td",ge,n(l.horario),1),e("td",we,n(l.total),1),e("td",ke,n(l.adelanto),1),e("td",Fe,n(l.total-l.adelanto),1),e("td",null,[t(J,{color:l.color,dense:"",size:"10px"},{default:o(()=>[h(n(l.estado),1)]),_:2},1032,["color"])]),e("td",null,n(l.observaciones),1),e("td",null,[e("div",Qe,n(l.user?.username),1)]),e("td",null,[e("div",ye,n(l.user_confirmado?.username),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Ie as default};
