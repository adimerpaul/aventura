import{aA as E,g as O,r,l as H,c as f,o as d,w as o,a as t,Q as G,e as P,a4 as v,a3 as z,b as e,ap as B,f as T,Z as x,a2 as b,t as n,a0 as h,a1 as g,a5 as Z,a6 as j}from"./index-o3y_L_Wt.js";import{Q as Y}from"./QSelect-CWixbgG5.js";import{Q as J}from"./QForm-DdAdMlv1.js";import{d as w,Q as k,a as u,b as c,c as K}from"./QList-BG-EMe5c.js";import{Q as W}from"./QBtnGroup-B2IM7zq-.js";import{Q as X}from"./QMarkupTable-BnsNT-Z2.js";import{Q as ee}from"./QPage-DXn5XNEt.js";import{h as q}from"./moment-C5S46NFB.js";import"./format-Co7Bf8AD.js";const le={class:"row"},te={class:"col-6 col-md-2"},oe={class:"col-6 col-md-2"},ae={class:"col-6 col-md-2"},se={class:"col-6 col-md-2"},ne={class:"col-12 col-md-2 flex flex-center"},de={class:"col-12 col-md-12 q-pa-xs"},ie={key:0,class:"row"},re={class:"col-6 col-md-2 q-pa-xs"},ue={class:"text-weight-bold"},ce={class:"col-6 col-md-2 q-pa-xs"},pe={class:"text-weight-bold"},fe={class:"col-6 col-md-2 q-pa-xs"},me={class:"text-weight-bold"},_e={class:"col-6 col-md-2 q-pa-xs"},he={class:"text-weight-bold"},ve={class:"col-6 col-md-2 q-pa-xs"},xe={class:"text-weight-bold"},be={key:1,class:"text-green text-bold text-center"},ge={key:2,class:"text-red text-bold text-center"},we={style:{"font-size":"10px"}},ke={class:"text-right"},ye={class:"text-right"},Fe={class:"text-right"},Ce={class:"text-right"},Qe={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Ve={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Ae={style:{"font-size":"10px",width:"80px","white-space":"normal","overflow-wrap":"break-word"}},Le={__name:"Lista",setup($e){const I=E(),{proxy:p}=O(),y=r(q().format("YYYY-MM-DD")),F=r(q().format("YYYY-MM-DD")),m=r([]),D=r([]),_=r(!1),C=r(""),Q=r([]),V=r(0),A=r("Todo"),U=r("Todo");H(()=>{$(),L()});function L(){Q.value=[{id:0,name:"Todos"}],p.$axios.get("users").then(s=>{s.data.forEach(a=>{Q.value.push(a)})}).catch(s=>{console.log(s)})}function M(){m.value=D.value.filter(s=>s.nombre.toLowerCase().includes(C.value.toLowerCase()))}function N(s){const a=parseFloat(s.adelanto).toFixed(2),l=parseFloat(s.total).toFixed(2),i=parseFloat(s.total-s.adelanto).toFixed(2);p.$alert.dialogConfirm('<span style="color: blue;font-size: 20px;font-weight: bold">¿Desea confirmar la reserva? <br> </span>Total: '+l+"<br>Adelanto: "+a+'<br><span style="color: red;font-size: 20px;font-weight: bold">Saldo: '+i+" Bs</span>").onOk(()=>{_.value=!0,p.$axios.post("reservasConfirmar",{id:s.id}).then(S=>{p.$socket.emit("reservas"),I.push("/reservas")}).catch(S=>{p.$alert.error(S.response.data.message,"Error"),_.value=!1})})}function R(s){p.$alert.dialogAnular('<span style="color: red;font-size: 20px;font-weight: bold">¿Desea anular la reserva?</span>').onOk(()=>{_.value=!0,p.$axios.post("reservasAnular",{id:s}).then(a=>{p.$socket.emit("reservas"),$()}).catch(a=>{console.log(a)})})}function $(){_.value=!0,p.$axios.get("reservasAll",{params:{fechaInicio:y.value,fechaFin:F.value,user_id:V.value,tipo:A.value,agencia:U.value}}).then(s=>{m.value=s.data,D.value=s.data}).catch(s=>{console.log(s)}).finally(()=>{_.value=!1})}return(s,a)=>(d(),f(ee,{class:"q-pa-xs"},{default:o(()=>[t(G,{flat:"",bordered:""},{default:o(()=>[t(P,{class:"q-pa-xs"},{default:o(()=>[t(J,{onSubmit:$},{default:o(()=>[e("div",le,[e("div",te,[t(B,{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=l=>y.value=l),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",oe,[t(B,{modelValue:F.value,"onUpdate:modelValue":a[1]||(a[1]=l=>F.value=l),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),e("div",ae,[s.$store.user.role==="Admin"?(d(),f(Y,{key:0,modelValue:V.value,"onUpdate:modelValue":a[2]||(a[2]=l=>V.value=l),label:"Usuario",outlined:"",dense:"",options:Q.value,"emit-value":"","map-options":"","option-value":"id","option-label":"name"},null,8,["modelValue","options"])):z("",!0)]),e("div",se,[s.$store.user.role==="Admin"?(d(),f(Y,{key:0,modelValue:A.value,"onUpdate:modelValue":a[3]||(a[3]=l=>A.value=l),label:"Tipo",outlined:"",dense:"",options:["Todo","Adelanto","Confirmado"]},null,8,["modelValue"])):z("",!0)]),e("div",ne,[t(T,{label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:_.value},null,8,["loading"])]),e("div",de,[t(B,{modelValue:C.value,"onUpdate:modelValue":[a[4]||(a[4]=l=>C.value=l),M],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])])])]),_:1}),s.$store.user.role==="Admin"?(d(),v("div",ie,[e("div",re,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[e("span",ue,n(m.value.length)+" reservas ",1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[5]||(a[5]=[h(" Cantidad ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",ce,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"orange","text-color":"white",icon:"attach_money"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[e("span",pe," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.adelanto),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[6]||(a[6]=[h(" Adelanto ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",fe,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"blue","text-color":"white",icon:"attach_money"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[e("span",me," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.saldo),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[7]||(a[7]=[h(" Saldo ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",_e,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[e("span",he," Bs "+n(m.value.filter(l=>l.estado!=="Cancelado").reduce((l,i)=>l+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[8]||(a[8]=[h(" Total ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})]),e("div",ve,[t(w,{bordered:"",padding:"",dense:""},{default:o(()=>[x((d(),f(k,{clickable:"",dense:""},{default:o(()=>[t(u,{avatar:""},{default:o(()=>[t(b,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),t(u,null,{default:o(()=>[t(c,{lines:"1"},{default:o(()=>[e("span",xe," Bs "+n(m.value.filter(l=>l.estado==="Cancelado").reduce((l,i)=>l+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),t(c,{caption:"",lines:"2"},{default:o(()=>a[9]||(a[9]=[h(" Anulados ")])),_:1})]),_:1})]),_:1})),[[g]])]),_:1})])])):z("",!0),t(X,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[a[12]||(a[12]=e("thead",null,[e("tr",{class:"bg-green text-white"},[e("th",null,"Opcion"),e("th",null,"Nombre"),e("th",null,"Sala"),e("th",null,"Fecha"),e("th",null,"Hora"),e("th",null,"Total"),e("th",null,"Adelanto"),e("th",null,"Saldo"),e("th",null,"Estado"),e("th",null,"Observaciones"),e("th",null,"Adelanto"),e("th",null,"Confirmado"),e("th",null,"Agencia")])],-1)),e("tbody",null,[(d(!0),v(Z,null,j(m.value,l=>(d(),v("tr",{key:l.id},[e("td",null,[l.estado==="Reservado"?(d(),f(W,{key:0},{default:o(()=>[t(T,{dense:"",label:"Anular",color:"red",icon:"delete","no-caps":"",onClick:i=>R(l.id),size:"10px",loading:_.value},null,8,["onClick","loading"]),t(T,{dense:"",label:"Confirmar",color:"blue",icon:"check","no-caps":"",onClick:i=>N(l),size:"10px",loading:_.value},null,8,["onClick","loading"])]),_:2},1024)):l.estado==="Finalizado"?(d(),v("div",be," Finalizado ")):(d(),v("div",ge,[a[10]||(a[10]=h(" Anulado ")),a[11]||(a[11]=e("br",null,null,-1)),e("div",we,n(l.user_cancelado?.name),1)]))]),e("td",null,n(l.nombre),1),e("td",null,n(l.sala),1),e("td",null,n(s.$filters.dateDmYHis(l.fecha_creacion)),1),e("td",ke,n(l.horario),1),e("td",ye,n(l.total),1),e("td",Fe,n(l.adelanto),1),e("td",Ce,n(l.total-l.adelanto),1),e("td",null,[t(K,{color:l.color,dense:"",size:"10px"},{default:o(()=>[h(n(l.estado),1)]),_:2},1032,["color"])]),e("td",null,n(l.observaciones),1),e("td",null,[e("div",Qe,n(l.user?.username),1)]),e("td",null,[e("div",Ve,n(l.user_confirmado?.username),1)]),e("td",null,[e("div",Ae,n(l.agencia),1)])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}))}};export{Le as default};
