import{g as w,r as c,V as B,Y as V,c as Y,o as i,w as r,a as s,Q as E,e as _,as as C,b as e,a5 as g,f as D,a1 as m,a2 as x,a3 as k,t as h}from"./index-BU3plpon.js";import{Q as I}from"./QForm-Do5n-57R.js";import{Q as O}from"./QMarkupTable-B1jPLfSb.js";import{Q as S}from"./QPage-C7Cuzh7s.js";import{h as F}from"./moment-C5S46NFB.js";const U={class:"row"},z={class:"col-12 col-md-2"},T={class:"col-12 col-md-2"},W={class:"col-12 col-md-2 flex flex-center"},L={class:"row"},N={class:"col-12"},H={__name:"Metricas",setup($){const{proxy:M}=w(),f=c(F().startOf("isoWeek").format("YYYY-MM-DD")),p=c(F().endOf("isoWeek").format("YYYY-MM-DD")),n=c([]),b=c([]),u=c({chart:{type:"bar",height:350,stacked:!0,toolbar:{show:!0},zoom:{enabled:!0}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:[]},yaxis:{title:{text:"Monto Total (Bs)"}},fill:{opacity:1},tooltip:{y:{formatter:l=>`${l} Bs`}}});B(()=>{});function Q(){M.$axios.get("/metricas",{params:{fechaInicio:f.value,fechaFin:p.value}}).then(l=>{console.log("Datos recibidos:",l.data),n.value=l.data.arrayFecha;const o=n.value.map(a=>a.fechaFormat),d=new Set;n.value.forEach(a=>{a.cajas.forEach(v=>{d.add(v.user?.name)})});const t={};d.forEach(a=>{t[a]=new Array(o.length).fill(0)}),n.value.forEach((a,v)=>{a.cajas.forEach(y=>{t[y.user?.name][v]=parseFloat(y.monto_real)})}),b.value=Object.keys(t).map(a=>({name:a,data:t[a]})),console.log("Categorías actualizadas:",o),u.value.xaxis.categories=o,u.value={...u.value}}).catch(l=>{console.error("Error al obtener métricas:",l)})}return(l,o)=>{const d=V("apexchart");return i(),Y(S,{class:"q-pa-xs"},{default:r(()=>[s(E,null,{default:r(()=>[s(_,null,{default:r(()=>[s(I,{onSubmit:C(Q,["prevent"])},{default:r(()=>[e("div",U,[e("div",z,[s(g,{dense:"",outlined:"",modelValue:f.value,"onUpdate:modelValue":o[0]||(o[0]=t=>f.value=t),label:"Fecha Inicio",type:"date"},null,8,["modelValue"])]),e("div",T,[s(g,{dense:"",outlined:"",modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=t=>p.value=t),label:"Fecha Fin",type:"date"},null,8,["modelValue"])]),e("div",W,[s(D,{color:"primary",label:"Buscar",type:"submit",icon:"search","no-caps":""})])])]),_:1})]),_:1}),s(_,null,{default:r(()=>[e("div",L,[e("div",N,[s(d,{type:"bar",height:"350",options:u.value,series:b.value},null,8,["options","series"])])])]),_:1}),s(_,null,{default:r(()=>[s(O,{dense:"",flat:"",bordered:""},{default:r(()=>[o[2]||(o[2]=e("thead",null,[e("tr",null,[e("th",null,"Fecha"),e("th",null,"Total (Bs)"),e("th",null,"Usuarios y Montos")])],-1)),e("tbody",null,[(i(!0),m(x,null,k(n.value,t=>(i(),m("tr",{key:t.fecha},[e("td",null,h(t.fechaFormat),1),e("td",null,h(t.monto_total),1),e("td",null,[(i(!0),m(x,null,k(t.cajas,a=>(i(),m("div",{key:a.id},h(a.user?.name)+" - "+h(a.monto_real)+" Bs ",1))),128))])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{H as default};
