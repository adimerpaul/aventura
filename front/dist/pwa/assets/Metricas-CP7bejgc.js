import{g as w,r as c,l as B,$ as V,c as Y,o as i,w as r,a as s,Q as E,e as _,aw as C,b as e,ap as x,f as D,a4 as m,a5 as F,a6 as M,t as f}from"./index-gHp625-a.js";import{Q as I}from"./QForm-DX3Dsrq9.js";import{Q as O}from"./QMarkupTable-BeLlV9km.js";import{Q as S}from"./QPage-CmNNLiaB.js";import{h as k}from"./moment-C5S46NFB.js";const U={class:"row"},T={class:"col-12 col-md-2"},W={class:"col-12 col-md-2"},$={class:"col-12 col-md-2 flex flex-center"},z={class:"row"},L={class:"col-12"},H={__name:"Metricas",setup(N){const{proxy:Q}=w(),h=c(k().startOf("isoWeek").format("YYYY-MM-DD")),p=c(k().endOf("isoWeek").format("YYYY-MM-DD")),n=c([]),y=c([]),u=c({chart:{height:350,type:"bar"},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:[]},yaxis:{title:{text:"Monto Total (Bs)"}},fill:{opacity:1},tooltip:{y:{formatter:l=>`${l} Bs`}}});B(()=>{b()});function b(){Q.$axios.get("/metricas",{params:{fechaInicio:h.value,fechaFin:p.value}}).then(l=>{console.log("Datos recibidos:",l.data),n.value=l.data.arrayFecha;const o=n.value.map(a=>a.fechaFormat),d=new Set;n.value.forEach(a=>{a.cajas.forEach(v=>{d.add(v.user.name)})});const t={};d.forEach(a=>{t[a]=new Array(o.length).fill(0)}),n.value.forEach((a,v)=>{a.cajas.forEach(g=>{t[g.user.name][v]=parseFloat(g.monto_real)})}),y.value=Object.keys(t).map(a=>({name:a,data:t[a]})),console.log("Categorías actualizadas:",o),u.value.xaxis.categories=o,u.value={...u.value}}).catch(l=>{console.error("Error al obtener métricas:",l)})}return(l,o)=>{const d=V("apexchart");return i(),Y(S,{class:"q-pa-xs"},{default:r(()=>[s(E,null,{default:r(()=>[s(_,null,{default:r(()=>[s(I,{onSubmit:C(b,["prevent"])},{default:r(()=>[e("div",U,[e("div",T,[s(x,{dense:"",outlined:"",modelValue:h.value,"onUpdate:modelValue":o[0]||(o[0]=t=>h.value=t),label:"Fecha Inicio",type:"date"},null,8,["modelValue"])]),e("div",W,[s(x,{dense:"",outlined:"",modelValue:p.value,"onUpdate:modelValue":o[1]||(o[1]=t=>p.value=t),label:"Fecha Fin",type:"date"},null,8,["modelValue"])]),e("div",$,[s(D,{color:"primary",label:"Buscar",type:"submit",icon:"search","no-caps":""})])])]),_:1})]),_:1}),s(_,null,{default:r(()=>[e("div",z,[e("div",L,[s(d,{type:"bar",height:"350",options:u.value,series:y.value},null,8,["options","series"])])])]),_:1}),s(_,null,{default:r(()=>[s(O,{dense:"",flat:"",bordered:""},{default:r(()=>[o[2]||(o[2]=e("thead",null,[e("tr",null,[e("th",null,"Fecha"),e("th",null,"Total (Bs)"),e("th",null,"Usuarios y Montos")])],-1)),e("tbody",null,[(i(!0),m(F,null,M(n.value,t=>(i(),m("tr",{key:t.fecha},[e("td",null,f(t.fechaFormat),1),e("td",null,f(t.monto_total),1),e("td",null,[(i(!0),m(F,null,M(t.cajas,a=>(i(),m("div",{key:a.id},f(a.user.name)+" - "+f(a.monto_real)+" Bs ",1))),128))])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{H as default};
