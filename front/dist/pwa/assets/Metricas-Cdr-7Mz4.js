import{g as B,r as u,l as C,$ as E,c as V,o as d,w as r,a as s,Q as Y,e as b,as as D,b as e,ap as k,f as I,a4 as f,a5 as F,a6 as M,t as h}from"./index-CZ4ZY1DO.js";import{Q as O}from"./QForm-BgSozSfx.js";import{Q as S}from"./QMarkupTable-DYxCZhAJ.js";import{Q as $}from"./QPage-J3mg8W0A.js";import{h as w}from"./moment-C5S46NFB.js";const U={class:"row"},z={class:"col-12 col-md-2"},P={class:"col-12 col-md-2"},T={class:"col-12 col-md-2 flex flex-center"},W={class:"row"},L={class:"col-12"},J={__name:"Metricas",setup(N){const{proxy:p}=B(),v=u(w().startOf("isoWeek").format("YYYY-MM-DD")),_=u(w().endOf("isoWeek").format("YYYY-MM-DD")),n=u([]),y=u([]),m=u({chart:{type:"bar",height:350,stacked:!0,toolbar:{show:!0},zoom:{enabled:!0}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:[]},yaxis:{title:{text:"Monto Total (Bs)"}},fill:{opacity:1},tooltip:{y:{formatter:c=>`${c} Bs`}}});C(()=>{});function Q(){p.$alert.dialogPromptPassword("Ingrese Codigo").onOk(c=>{console.log(c),c==="aventura"?p.$axios.get("/metricas",{params:{fechaInicio:v.value,fechaFin:_.value}}).then(a=>{console.log("Datos recibidos:",a.data),n.value=a.data.arrayFecha;const i=n.value.map(t=>t.fechaFormat),o=new Set;n.value.forEach(t=>{t.cajas.forEach(g=>{o.add(g.user.name)})});const l={};o.forEach(t=>{l[t]=new Array(i.length).fill(0)}),n.value.forEach((t,g)=>{t.cajas.forEach(x=>{l[x.user.name][g]=parseFloat(x.monto_real)})}),y.value=Object.keys(l).map(t=>({name:t,data:l[t]})),console.log("Categorías actualizadas:",i),m.value.xaxis.categories=i,m.value={...m.value}}).catch(a=>{console.error("Error al obtener métricas:",a)}):p.$alert.error("Contraseña incorrecta","Error")}).onCancel(()=>{})}return(c,a)=>{const i=E("apexchart");return d(),V($,{class:"q-pa-xs"},{default:r(()=>[s(Y,null,{default:r(()=>[s(b,null,{default:r(()=>[s(O,{onSubmit:D(Q,["prevent"])},{default:r(()=>[e("div",U,[e("div",z,[s(k,{dense:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=o=>v.value=o),label:"Fecha Inicio",type:"date"},null,8,["modelValue"])]),e("div",P,[s(k,{dense:"",outlined:"",modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=o=>_.value=o),label:"Fecha Fin",type:"date"},null,8,["modelValue"])]),e("div",T,[s(I,{color:"primary",label:"Buscar",type:"submit",icon:"search","no-caps":""})])])]),_:1})]),_:1}),s(b,null,{default:r(()=>[e("div",W,[e("div",L,[s(i,{type:"bar",height:"350",options:m.value,series:y.value},null,8,["options","series"])])])]),_:1}),s(b,null,{default:r(()=>[s(S,{dense:"",flat:"",bordered:""},{default:r(()=>[a[2]||(a[2]=e("thead",null,[e("tr",null,[e("th",null,"Fecha"),e("th",null,"Total (Bs)"),e("th",null,"Usuarios y Montos")])],-1)),e("tbody",null,[(d(!0),f(F,null,M(n.value,o=>(d(),f("tr",{key:o.fecha},[e("td",null,h(o.fechaFormat),1),e("td",null,h(o.monto_total),1),e("td",null,[(d(!0),f(F,null,M(o.cajas,l=>(d(),f("div",{key:l.id},h(l.user.name)+" - "+h(l.monto_real)+" Bs ",1))),128))])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{J as default};
