import{g as B,r as i,V as C,Y as V,c as Y,o as u,w as r,a as s,Q as E,e as b,as as D,b as e,a5 as k,f as I,a1 as f,a2 as F,a3 as M,t as h}from"./index-BvB1m-Y0.js";import{Q as O}from"./QForm-DiyE0kRF.js";import{Q as S}from"./QMarkupTable-CWVrA4Ce.js";import{Q as U}from"./QPage-r4XHt9iD.js";import{h as w}from"./moment-C5S46NFB.js";const $={class:"row"},z={class:"col-12 col-md-2"},P={class:"col-12 col-md-2"},T={class:"col-12 col-md-2 flex flex-center"},W={class:"row"},L={class:"col-12"},J={__name:"Metricas",setup(N){const{proxy:p}=B(),v=i(w().startOf("isoWeek").format("YYYY-MM-DD")),_=i(w().endOf("isoWeek").format("YYYY-MM-DD")),n=i([]),y=i([]),d=i({chart:{type:"bar",height:350,stacked:!0,toolbar:{show:!0},zoom:{enabled:!0}},plotOptions:{bar:{horizontal:!1,columnWidth:"55%",endingShape:"rounded"}},dataLabels:{enabled:!1},stroke:{show:!0,width:2,colors:["transparent"]},xaxis:{categories:[]},yaxis:{title:{text:"Monto Total (Bs)"}},fill:{opacity:1},tooltip:{y:{formatter:m=>`${m} Bs`}}});C(()=>{});function Q(){p.$alert.dialogPromptPassword("Ingrese Codigo").onOk(m=>{m==="aventura"?p.$axios.get("/metricas",{params:{fechaInicio:v.value,fechaFin:_.value}}).then(a=>{console.log("Datos recibidos:",a.data),n.value=a.data.arrayFecha;const c=n.value.map(o=>o.fechaFormat),t=new Set;n.value.forEach(o=>{o.cajas.forEach(g=>{t.add(g.user?.name)})});const l={};t.forEach(o=>{l[o]=new Array(c.length).fill(0)}),n.value.forEach((o,g)=>{o.cajas.forEach(x=>{l[x.user?.name][g]=parseFloat(x.monto_real)})}),y.value=Object.keys(l).map(o=>({name:o,data:l[o]})),console.log("Categorías actualizadas:",c),d.value.xaxis.categories=c,d.value={...d.value}}).catch(a=>{console.error("Error al obtener métricas:",a)}):p.$alert.error("Contraseña incorrecta","Error")}).onCancel(()=>{})}return(m,a)=>{const c=V("apexchart");return u(),Y(U,{class:"q-pa-xs"},{default:r(()=>[s(E,null,{default:r(()=>[s(b,null,{default:r(()=>[s(O,{onSubmit:D(Q,["prevent"])},{default:r(()=>[e("div",$,[e("div",z,[s(k,{dense:"",outlined:"",modelValue:v.value,"onUpdate:modelValue":a[0]||(a[0]=t=>v.value=t),label:"Fecha Inicio",type:"date"},null,8,["modelValue"])]),e("div",P,[s(k,{dense:"",outlined:"",modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=t=>_.value=t),label:"Fecha Fin",type:"date"},null,8,["modelValue"])]),e("div",T,[s(I,{color:"primary",label:"Buscar",type:"submit",icon:"search","no-caps":""})])])]),_:1})]),_:1}),s(b,null,{default:r(()=>[e("div",W,[e("div",L,[s(c,{type:"bar",height:"350",options:d.value,series:y.value},null,8,["options","series"])])])]),_:1}),s(b,null,{default:r(()=>[s(S,{dense:"",flat:"",bordered:""},{default:r(()=>[a[2]||(a[2]=e("thead",null,[e("tr",null,[e("th",null,"Fecha"),e("th",null,"Total (Bs)"),e("th",null,"Usuarios y Montos")])],-1)),e("tbody",null,[(u(!0),f(F,null,M(n.value,t=>(u(),f("tr",{key:t.fecha},[e("td",null,h(t.fechaFormat),1),e("td",null,h(t.monto_total),1),e("td",null,[(u(!0),f(F,null,M(t.cajas,l=>(u(),f("div",{key:l.id},h(l.user?.name)+" - "+h(l.monto_real)+" Bs ",1))),128))])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})}}};export{J as default};
