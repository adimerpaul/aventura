import{g as E,r as i,l as U,c as x,o as u,w as r,a as o,Q,e as h,b as t,ap as g,f as b,a4 as s,a5 as C,a6 as $,t as c,a3 as w,h as M,as as I}from"./index-BhipJvXX.js";import{Q as q}from"./QForm-DM27dV5a.js";import{Q as L}from"./QMarkupTable-COKWGWly.js";import{Q as z}from"./QSpace-C6kxYhB7.js";import{Q as D}from"./QPage-CB9oVPxd.js";import{u as F}from"./use-quasar-ClfMeSBw.js";const j={class:"row"},G={class:"col-12 col-md-4"},O={class:"col-12 col-md-8 text-right"},T={key:0},H={key:0},J={key:1},le={__name:"Producto",setup(K){const{proxy:m}=E(),k=i([]),_=i([]),V=i(""),d=i(!1),a=i({id:null,nombre:"",precio:"",stock:""}),y=F(),p=i(!1);U(()=>{v()});function P(){k.value=_.value.filter(n=>n.nombre.toLowerCase().includes(V.value.toLowerCase()))}function v(){m.$axios.get("/productos").then(n=>{k.value=n.data,_.value=n.data})}function S(){a.value={id:null,nombre:"",precio:"",stock:""},d.value=!0}function N(n){a.value={...n},d.value=!0}function A(){if(a.value.id){const n=_.value.find(l=>l.id===a.value.id);if(n&&parseInt(a.value.stock)<n.stock){y.notify({type:"warning",message:"No se puede reducir el stock. Solo se permite aumentarlo.",position:"top"});return}m.$axios.put(`/productos/${a.value.id}`,a.value).then(v)}else m.$axios.post("/productos",a.value).then(v);d.value=!1}function B(n){y.dialog({title:"Eliminar producto",message:"¿Está seguro de eliminar este producto?",persistent:!0,ok:{label:"Sí",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{p.value=!0,m.$axios.delete(`/productos/${n}`).then(v).catch(l=>{m.$alert.error(l.response.data.message,"Error")}).finally(()=>{p.value=!1})})}return(n,l)=>(u(),x(D,{class:"q-pa-xs"},{default:r(()=>[o(Q,{flat:"",bordered:""},{default:r(()=>[o(h,{class:"q-pa-xs"},{default:r(()=>[o(q,{onSubmit:v},{default:r(()=>[t("div",j,[t("div",G,[o(g,{modelValue:V.value,"onUpdate:modelValue":[l[0]||(l[0]=e=>V.value=e),P],label:"Buscar producto",outlined:"",dense:""},null,8,["modelValue"])]),t("div",O,[o(b,{label:"Agregar",color:"green",icon:"add_circle_outline","no-caps":"",onClick:S,loading:p.value},null,8,["loading"])])])]),_:1}),o(L,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:r(()=>[l[6]||(l[6]=t("thead",null,[t("tr",{class:"text-bold bg-primary text-white"},[t("th",null,"Nombre"),t("th",null,"Combo"),t("th",null,"Precio"),t("th",null,"Stock"),t("th",null,"Agencia"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(u(!0),s(C,null,$(k.value,e=>(u(),s("tr",{key:e.id},[t("td",null,c(e.nombre),1),t("td",null,[e.producto_combo.length?(u(),s("ul",T,[(u(!0),s(C,null,$(e.producto_combo,f=>(u(),s("li",{key:f.id},c(f.cantidad)+" x "+c(f.producto_hijo?.nombre),1))),128))])):w("",!0)]),t("td",null,c(e.precio),1),t("td",null,c(e.stock),1),t("td",null,c(e.agencia),1),t("td",null,[o(b,{icon:"edit",color:"blue",class:"q-mr-md",size:"10px",dense:"",onClick:f=>N(e),loading:p.value},null,8,["onClick","loading"]),n.$store.user.role==="Admin"?(u(),x(b,{key:0,icon:"delete",color:"red",size:"10px",dense:"",onClick:f=>B(e.id),loading:p.value},null,8,["onClick","loading"])):w("",!0)])]))),128))])]),_:1})]),_:1})]),_:1}),o(M,{modelValue:d.value,"onUpdate:modelValue":l[5]||(l[5]=e=>d.value=e)},{default:r(()=>[o(Q,null,{default:r(()=>[o(h,{class:"text-h6 q-pb-none row items-center"},{default:r(()=>[a.value.id?(u(),s("div",H,"Editar producto")):(u(),s("div",J,"Agregar producto")),o(z),o(b,{flat:"",dense:"",icon:"close",onClick:l[1]||(l[1]=e=>d.value=!1)})]),_:1}),o(h,null,{default:r(()=>[o(q,{onSubmit:I(A,["prevent"])},{default:r(()=>[o(g,{modelValue:a.value.nombre,"onUpdate:modelValue":l[2]||(l[2]=e=>a.value.nombre=e),label:"Nombre",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(g,{modelValue:a.value.precio,"onUpdate:modelValue":l[3]||(l[3]=e=>a.value.precio=e),label:"Precio",type:"number",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(g,{modelValue:a.value.stock,"onUpdate:modelValue":l[4]||(l[4]=e=>a.value.stock=e),label:"Stock",type:"number",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(b,{label:"Guardar",color:"primary",type:"submit",class:"q-mt-md"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{le as default};
