import{g as E,r as d,l as M,c as V,o as u,w as n,a as o,Q,e as h,b as l,ap as y,f as g,a4 as s,a5 as C,a6 as $,t as c,a3 as w,h as U,as as I}from"./index-WGDN3iW5.js";import{Q as P}from"./QForm-DL2L5zcI.js";import{Q as L}from"./QMarkupTable-Dh9OlRQT.js";import{Q as z}from"./QSpace-B89ZPcb_.js";import{Q as D}from"./QPage-CzI-8C-K.js";import{u as F}from"./use-quasar-fUsYecsZ.js";const j={class:"row"},G={class:"col-12 col-md-4"},O={class:"col-12 col-md-8 text-right"},T={key:0},H={key:0},J={key:1},le={__name:"Producto",setup(K){const{proxy:m}=E(),b=d([]),k=d([]),_=d(""),i=d(!1),a=d({id:null,nombre:"",precio:"",stock:""}),x=F(),p=d(!1);M(()=>{f()});function q(){b.value=k.value.filter(r=>r.nombre.toLowerCase().includes(_.value.toLowerCase()))}function f(){m.$axios.get("/productos").then(r=>{b.value=r.data,k.value=r.data})}function S(){a.value={id:null,nombre:"",precio:"",stock:""},i.value=!0}function N(r){a.value={...r},i.value=!0}function A(){if(a.value.id){const r=k.value.find(t=>t.id===a.value.id);if(r&&parseInt(a.value.stock)<r.stock){x.notify({type:"warning",message:"No se puede reducir el stock. Solo se permite aumentarlo.",position:"top"});return}m.$axios.put(`/productos/${a.value.id}`,a.value).then(f)}else m.$axios.post("/productos",a.value).then(f);i.value=!1}function B(r){x.dialog({title:"Eliminar producto",message:"¿Está seguro de eliminar este producto?",persistent:!0,ok:{label:"Sí",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{p.value=!0,m.$axios.delete(`/productos/${r}`).then(f).catch(t=>{m.$alert.error(t.response.data.message,"Error")}).finally(()=>{p.value=!1})})}return(r,t)=>(u(),V(D,{class:"q-pa-xs"},{default:n(()=>[o(Q,{flat:"",bordered:""},{default:n(()=>[o(h,{class:"q-pa-xs"},{default:n(()=>[o(P,{onSubmit:f},{default:n(()=>[l("div",j,[l("div",G,[o(y,{modelValue:_.value,"onUpdate:modelValue":[t[0]||(t[0]=e=>_.value=e),q],label:"Buscar producto",outlined:"",dense:""},null,8,["modelValue"])]),l("div",O,[o(g,{label:"Agregar",color:"green",icon:"add_circle_outline","no-caps":"",onClick:S,loading:p.value},null,8,["loading"])])])]),_:1}),o(L,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:n(()=>[t[5]||(t[5]=l("thead",null,[l("tr",{class:"text-bold bg-primary text-white"},[l("th",null,"Nombre"),l("th",null,"Combo"),l("th",null,"Precio"),l("th",null,"Stock"),l("th",null,"Agencia"),l("th",null,"Acciones")])],-1)),l("tbody",null,[(u(!0),s(C,null,$(b.value,e=>(u(),s("tr",{key:e.id},[l("td",null,c(e.nombre),1),l("td",null,[e.producto_combo.length?(u(),s("ul",T,[(u(!0),s(C,null,$(e.producto_combo,v=>(u(),s("li",{key:v.id},c(v.cantidad)+" x "+c(v.producto_hijo?.nombre),1))),128))])):w("",!0)]),l("td",null,c(e.precio),1),l("td",null,c(e.stock),1),l("td",null,c(e.agencia),1),l("td",null,[o(g,{icon:"edit",color:"blue",class:"q-mr-md",size:"10px",dense:"",onClick:v=>N(e),loading:p.value},null,8,["onClick","loading"]),r.$store.user.role==="Admin"?(u(),V(g,{key:0,icon:"delete",color:"red",size:"10px",dense:"",onClick:v=>B(e.id),loading:p.value},null,8,["onClick","loading"])):w("",!0)])]))),128))])]),_:1})]),_:1})]),_:1}),o(U,{modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=e=>i.value=e)},{default:n(()=>[o(Q,null,{default:n(()=>[o(h,{class:"text-h6 q-pb-none row items-center"},{default:n(()=>[a.value.id?(u(),s("div",H,"Editar producto")):(u(),s("div",J,"Agregar producto")),o(z),o(g,{flat:"",dense:"",icon:"close",onClick:t[1]||(t[1]=e=>i.value=!1)})]),_:1}),o(h,null,{default:n(()=>[o(P,{onSubmit:I(A,["prevent"])},{default:n(()=>[o(y,{modelValue:a.value.nombre,"onUpdate:modelValue":t[2]||(t[2]=e=>a.value.nombre=e),label:"Nombre",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(y,{modelValue:a.value.precio,"onUpdate:modelValue":t[3]||(t[3]=e=>a.value.precio=e),label:"Precio",type:"number",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),o(g,{label:"Guardar",color:"primary",type:"submit",class:"q-mt-md"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{le as default};
