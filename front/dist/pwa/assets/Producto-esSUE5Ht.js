import{z as E,aB as U,g as M,r as i,l as z,c as y,o as u,w as n,a as l,Q as x,e as V,b as t,ap as g,f,a4 as s,a5 as Q,a6 as C,t as b,a3 as $,h as L,aw as j}from"./index-CZFE6UgH.js";import{Q as q}from"./QForm-DDtxcMLv.js";import{Q as D}from"./QMarkupTable-CQIEHrXa.js";import{Q as F}from"./QSpace-DaS5WRS5.js";import{Q as I}from"./QPage-Dhn9d1Kv.js";function G(){return E(U)}const K={class:"row"},O={class:"col-12 col-md-4"},T={class:"col-12 col-md-8 text-right"},H={key:0},J={key:0},R={key:1},oe={__name:"Producto",setup(W){const{proxy:c}=M(),k=i([]),h=i([]),_=i(""),d=i(!1),a=i({id:null,nombre:"",precio:"",stock:""}),w=G(),m=i(!1);z(()=>{p()});function P(){k.value=h.value.filter(r=>r.nombre.toLowerCase().includes(_.value.toLowerCase()))}function p(){c.$axios.get("/productos").then(r=>{k.value=r.data,h.value=r.data})}function S(){a.value={id:null,nombre:"",precio:"",stock:""},d.value=!0}function B(r){a.value={...r},d.value=!0}function N(){a.value.id?c.$axios.put(`/productos/${a.value.id}`,a.value).then(p):c.$axios.post("/productos",a.value).then(p),d.value=!1}function A(r){w.dialog({title:"Eliminar producto",message:"¿Está seguro de eliminar este producto?",persistent:!0,ok:{label:"Sí",color:"negative",push:!0},cancel:{label:"No",color:"primary",push:!0}}).onOk(()=>{m.value=!0,c.$axios.delete(`/productos/${r}`).then(p).catch(o=>{c.$alert.error(o.response.data.message,"Error")}).finally(()=>{m.value=!1})})}return(r,o)=>(u(),y(I,{class:"q-pa-xs"},{default:n(()=>[l(x,{flat:"",bordered:""},{default:n(()=>[l(V,{class:"q-pa-xs"},{default:n(()=>[l(q,{onSubmit:p},{default:n(()=>[t("div",K,[t("div",O,[l(g,{modelValue:_.value,"onUpdate:modelValue":[o[0]||(o[0]=e=>_.value=e),P],label:"Buscar producto",outlined:"",dense:""},null,8,["modelValue"])]),t("div",T,[l(f,{label:"Agregar",color:"green",icon:"add_circle_outline","no-caps":"",onClick:S,loading:m.value},null,8,["loading"])])])]),_:1}),l(D,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:n(()=>[o[6]||(o[6]=t("thead",null,[t("tr",{class:"text-bold bg-primary text-white"},[t("th",null,"Nombre"),t("th",null,"Combo"),t("th",null,"Precio"),t("th",null,"Stock"),t("th",null,"Acciones")])],-1)),t("tbody",null,[(u(!0),s(Q,null,C(k.value,e=>(u(),s("tr",{key:e.id},[t("td",null,b(e.nombre),1),t("td",null,[e.producto_combo.length?(u(),s("ul",H,[(u(!0),s(Q,null,C(e.producto_combo,v=>(u(),s("li",{key:v.id},b(v.cantidad)+" x "+b(v.producto_hijo?.nombre),1))),128))])):$("",!0)]),t("td",null,b(e.precio),1),t("td",null,b(e.stock),1),t("td",null,[l(f,{icon:"edit",color:"blue",class:"q-mr-md",size:"10px",dense:"",onClick:v=>B(e),loading:m.value},null,8,["onClick","loading"]),r.$store.user.role==="Admin"?(u(),y(f,{key:0,icon:"delete",color:"red",size:"10px",dense:"",onClick:v=>A(e.id),loading:m.value},null,8,["onClick","loading"])):$("",!0)])]))),128))])]),_:1})]),_:1})]),_:1}),l(L,{modelValue:d.value,"onUpdate:modelValue":o[5]||(o[5]=e=>d.value=e)},{default:n(()=>[l(x,null,{default:n(()=>[l(V,{class:"text-h6 q-pb-none row items-center"},{default:n(()=>[a.value.id?(u(),s("div",J,"Editar producto")):(u(),s("div",R,"Agregar producto")),l(F),l(f,{flat:"",dense:"",icon:"close",onClick:o[1]||(o[1]=e=>d.value=!1)})]),_:1}),l(V,null,{default:n(()=>[l(q,{onSubmit:j(N,["prevent"])},{default:n(()=>[l(g,{modelValue:a.value.nombre,"onUpdate:modelValue":o[2]||(o[2]=e=>a.value.nombre=e),label:"Nombre",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),l(g,{modelValue:a.value.precio,"onUpdate:modelValue":o[3]||(o[3]=e=>a.value.precio=e),label:"Precio",type:"number",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),l(g,{modelValue:a.value.stock,"onUpdate:modelValue":o[4]||(o[4]=e=>a.value.stock=e),label:"Stock",type:"number",outlined:"",dense:"",required:"",hint:""},null,8,["modelValue"]),l(f,{label:"Guardar",color:"primary",type:"submit",class:"q-mt-md"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{oe as default};
