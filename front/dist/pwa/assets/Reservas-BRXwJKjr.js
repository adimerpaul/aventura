import{v as T,x as M,j as _,ad as q,c as $,o as m,w as c,a as r,Q as R,e as k,b as d,ap as g,f as v,a0 as b,t as h,a3 as p,a4 as f,a5 as y,a6 as S,a7 as w,h as B,aw as j,aq as O,ar as D,Z as H}from"./index-bYJ5MrON.js";import{Q as C,a as N}from"./QTh-BEHNGHGf.js";import{Q as U}from"./QMarkupTable-4zbHrrgN.js";import{Q as P}from"./QSpace-zn_Enfzf.js";import{Q as E}from"./QForm-zh2ohilY.js";import{Q as F}from"./QPage-Djoc1K4y.js";import{C as L}from"./ClosePopup-D7jTe9SU.js";import{h as V}from"./moment-C5S46NFB.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const z=["top","middle","bottom"],Q=T({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:s=>z.includes(s)}},setup(s,{slots:e}){const l=M(()=>s.align!==void 0?{verticalAlign:s.align}:null),a=M(()=>{const o=s.outline===!0&&s.color||s.textColor;return`q-badge flex inline items-center no-wrap q-badge--${s.multiLine===!0?"multi":"single"}-line`+(s.outline===!0?" q-badge--outline":s.color!==void 0?` bg-${s.color}`:"")+(o!==void 0?` text-${o}`:"")+(s.floating===!0?" q-badge--floating":"")+(s.rounded===!0?" q-badge--rounded":"")+(s.transparent===!0?" q-badge--transparent":"")});return()=>_("div",{class:a.value,style:l.value,role:"status","aria-label":s.label},q(e.default,s.label!==void 0?[s.label]:[]))}}),A={data(){return{fecha:V().format("YYYY-MM-DD"),salas:[],horarios:[],seleccionadas:{},totalMinutos:0,dialogoReservar:!1,nombre:"",personas:1,adelanto:0,observacion:"",loading:!1,directo:!1}},computed:{tiempoSeleccionado(){const s=Math.floor(this.totalMinutos/60),e=this.totalMinutos%60;return`${String(s).padStart(2,"0")}:${String(e).padStart(2,"0")}`},montoTotal(){return this.totalMinutos/30*5*(this.personas||1)},horaMinima(){return Object.keys(this.seleccionadas).length===0?"-":Object.values(this.seleccionadas).map(e=>V(e,"H:mm")).sort((e,l)=>e.diff(l))[0].format("H:mm")},horaMaxima(){if(Object.keys(this.seleccionadas).length===0)return"-";const s=Object.values(this.seleccionadas).map(l=>V(l,"H:mm")).sort((l,a)=>l.diff(a));return s[s.length-1].add(30,"minutes").format("H:mm")}},methods:{getRowspan(s,e){const l=`${s}-${e}`;if(!this.$store.reservas[l])return 1;let a=1;for(;this.$store.reservas[`${s+a}-${e}`]&&this.$store.reservas[`${s+a}-${e}`].nombre===this.$store.reservas[l].nombre;)a++;return a},getReservas(){this.loading=!0,this.$store.reservas={},this.$axios.get("/reservas",{params:{fecha:this.fecha}}).then(s=>{this.$store.reservas=s.data}).catch(()=>{this.$alert.error("Error al obtener reservas")}).finally(()=>{this.loading=!1})},limpiar(){this.seleccionadas={},this.totalMinutos=0,this.nombre="",this.personas=1,this.adelanto=0,this.observacion=""},clickReserva(){if(this.totalMinutos===0){this.$alert.error("Por favor selecciona al menos 30 minutos.");return}this.dialogoReservar=!0,this.nombre="",this.personas=2,this.adelanto=0,this.observacion="",this.directo=!1},shouldShowCell(s,e){const l=`${s}-${e}`,a=`${s-1}-${e}`;return this.$store.reservas[l]?!(s>0&&this.$store.reservas[a]&&this.$store.reservas[a].nombre===this.$store.reservas[l].nombre):!0},toggleSeleccion(s,e,l){const a=`${s}-${e}`;if(!this.$store.reservas[a]){if(Object.keys(this.seleccionadas).length===0){this.seleccionadas[a]=l,this.calcularTotalMinutos();return}this.seleccionadas[a]?delete this.seleccionadas[a]:this.seleccionadas[a]=l,this.calcularTotalMinutos()}},calcularTotalMinutos(){this.totalMinutos=Object.keys(this.seleccionadas).length*30},confirmarReserva(){Object.keys(this.seleccionadas).forEach(a=>{this.$store.reservas[a]={nombre:this.nombre,personas:this.personas,color:"yellow"}});const e=Object.keys(this.seleccionadas)[0].split("-")[1],l=this.salas[e]?.sala||"Desconocida";this.loading=!0,this.$axios.post("/reservas",{nombre:this.nombre,numero_personas:this.personas,observaciones:this.observacion,json:JSON.stringify(this.seleccionadas),sala:l,total:this.montoTotal,adelanto:this.adelanto,tiempo:this.tiempoSeleccionado,horario:`${this.horaMinima} - ${this.horaMaxima}`,fecha:this.fecha,directo:this.directo}).then(()=>{this.$alert.success("Reserva confirmada","Reserva"),this.limpiar(),this.getReservas(),this.dialogoReservar=!1,this.$socket.emit("reservas")}).catch(a=>{this.$alert.error(a.response.data.message,"Error al confirmar reserva")}).finally(()=>{this.loading=!1})}},mounted(){for(let e=0;e<20;e++)this.salas.push({sala:"Sala "+(e+1)});for(let e=8;e<23;e++){let l=`${e}:00`,a=`${e}:30`;this.horarios.push({hora:`${l}-${a}`}),l=`${e}:30`,a=`${e+1}:00`,this.horarios.push({hora:`${l}-${a}`})}this.calcularTotalMinutos(),this.getReservas();let s=this;this.$store.socketReservas||(this.$socket.on("reservas",()=>{s.getReservas()}),this.$store.socketReservas=!0)}},K={class:"row"},J={class:"col-6 col-md-2"},Z={class:"col-6 col-md-2 flex flex-center"},G={class:"col-6 col-md-2"},W={class:"col-6 col-md-3 text-right"},X={class:"scroll-body"},x=["rowspan","onClick"],I={key:0},ee={key:1},se={class:"text-bold q-mt-md text-blue bg-grey-3"},oe={class:"text-bold"},te={class:"text-red text-bold"};function ae(s,e,l,a,o,u){return m(),$(F,{class:"q-pa-xs"},{default:c(()=>[r(R,{flat:"",bordered:""},{default:c(()=>[r(k,{class:"q-pa-xs"},{default:c(()=>[d("div",K,[d("div",J,[r(g,{modelValue:o.fecha,"onUpdate:modelValue":[e[0]||(e[0]=t=>o.fecha=t),u.getReservas],type:"date",label:"Fecha",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),d("div",Z,[r(v,{color:"green",label:"Reservar",onClick:u.clickReserva,"no-caps":"",icon:"save",size:"11px",loading:o.loading},null,8,["onClick","loading"])]),d("div",G,[r(Q,{color:"indigo",class:"q-pa-sm"},{default:c(()=>[b(" Tiempo Seleccionado: "+h(u.tiempoSeleccionado),1)]),_:1})]),d("div",W,[Object.keys(o.seleccionadas).length>0?(m(),$(v,{key:0,color:"red",label:"Limpiar",onClick:u.limpiar,"no-caps":"",icon:"clear",size:"11px"},null,8,["onClick"])):p("",!0)]),e[9]||(e[9]=d("div",{class:"col-6 col-md-3 text-right"},null,-1))]),r(U,{"wrap-cells":"",dense:"",bordered:"",flat:"",separator:"cell",class:"tabla-reservas"},{default:c(()=>[d("thead",null,[d("tr",null,[r(C,{class:"bg-grey text-white sticky-hora"},{default:c(()=>e[10]||(e[10]=[b("Hora")])),_:1}),(m(!0),f(y,null,S(o.salas,t=>(m(),$(C,{class:"bg-blue text-white",key:t.sala},{default:c(()=>[b(h(t.sala),1)]),_:2},1024))),128))])]),d("tbody",X,[(m(!0),f(y,null,S(o.horarios,(t,i)=>(m(),f("tr",{key:i},[r(N,{class:"sticky-hora",style:{padding:"0",margin:"0",border:"0"}},{default:c(()=>[b(h(t.hora),1)]),_:2},1024),(m(!0),f(y,null,S(o.salas,(re,n)=>(m(),f(y,{key:n},[u.shouldShowCell(i,n)?(m(),f("td",{key:0,rowspan:u.getRowspan(i,n),class:w([{"bg-green text-white":o.seleccionadas[`${i}-${n}`]&&!s.$store.reservas[`${i}-${n}`],"bg-red text-white":s.$store.reservas[`${i}-${n}`]?.color==="red","bg-yellow text-black":s.$store.reservas[`${i}-${n}`]?.color==="yellow","bg-grey-3":!o.seleccionadas[`${i}-${n}`]&&!s.$store.reservas[`${i}-${n}`]},"text-center cursor-pointer"]),onClick:le=>u.toggleSeleccion(i,n,t.hora)},[s.$store.reservas[`${i}-${n}`]?(m(),f("div",I,h(s.$store.reservas[`${i}-${n}`].nombre),1)):p("",!0),s.$store.reservas[`${i}-${n}`]&&s.$store.reservas[`${i}-${n}`].fecha_confirmacion?(m(),f("div",ee,h(s.$store.reservas[`${i}-${n}`].fecha_confirmacion.substring(11,16)),1)):p("",!0)],10,x)):p("",!0)],64))),128))]))),128))])]),_:1})]),_:1})]),_:1}),r(B,{modelValue:o.dialogoReservar,"onUpdate:modelValue":e[8]||(e[8]=t=>o.dialogoReservar=t)},{default:c(()=>[r(R,{style:{"min-width":"250px"}},{default:c(()=>[r(k,{class:"q-pb-none row items-center"},{default:c(()=>[e[11]||(e[11]=d("div",{class:"text-h6"},"Reservar Sala",-1)),r(P),r(v,{flat:"",dense:"",round:"",icon:"close",class:"q-ml-auto",onClick:e[1]||(e[1]=t=>o.dialogoReservar=!1)})]),_:1}),r(k,null,{default:c(()=>[r(E,{onSubmit:j(u.confirmarReserva,["prevent"])},{default:c(()=>[r(g,{modelValue:o.nombre,"onUpdate:modelValue":e[2]||(e[2]=t=>o.nombre=t),label:"Nombre",dense:"",outlined:"",class:"",rules:[t=>!!t||"Por favor, ingresa un nombre."]},null,8,["modelValue","rules"]),r(g,{modelValue:o.personas,"onUpdate:modelValue":e[3]||(e[3]=t=>o.personas=t),modelModifiers:{number:!0},type:"number",label:"Número de Personas",dense:"",outlined:"",class:"",rules:[t=>t>0||"Por favor, ingresa un número válido."]},null,8,["modelValue","rules"]),r(g,{modelValue:o.adelanto,"onUpdate:modelValue":e[4]||(e[4]=t=>o.adelanto=t),modelModifiers:{number:!0},type:"number",label:"Adelanto",dense:"",outlined:"",class:"",rules:[t=>t>=0||"Por favor, ingresa un número válido."]},null,8,["modelValue","rules"]),r(g,{modelValue:o.observacion,"onUpdate:modelValue":e[5]||(e[5]=t=>o.observacion=t),label:"Observación",dense:"",outlined:"",type:"textarea"},null,8,["modelValue"]),r(O,{modelValue:o.directo,"onUpdate:modelValue":[e[6]||(e[6]=t=>o.directo=t),e[7]||(e[7]=t=>o.adelanto=u.montoTotal)],label:o.directo?"Venta Directa":"Reserva",class:w({"text-primary":o.directo,"text-orange":!o.directo})},null,8,["modelValue","label","class"]),d("div",null,[r(Q,{color:"indigo",class:"q-pa-sm"},{default:c(()=>[b(" Horario Seleccionado: Desde "+h(u.horaMinima)+" hasta "+h(u.horaMaxima),1)]),_:1})]),d("div",se," Tiempo Total: "+h(u.tiempoSeleccionado),1),d("div",oe," Monto Total: "+h(u.montoTotal)+" Bs ",1),d("div",te," Saldo: "+h(u.montoTotal-o.adelanto)+" Bs ",1),r(D,{align:"right"},{default:c(()=>[H(r(v,{flat:"",label:"Cancelar","no-caps":"",loading:o.loading},null,8,["loading"]),[[L]]),r(v,{color:"green",label:"Confirmar","no-caps":"",type:"submit",loading:o.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const ve=Y(A,[["render",ae]]);export{ve as default};
