import{v as Q,x as V,j as T,ad as O,c as $,o as h,w as d,a as l,Q as _,e as k,b as n,ap as g,t as m,f as p,a0 as v,a3 as S,a4 as f,a5 as y,a6 as M,a7 as R,h as j,aw as q,aq as B,ar as D,Z as H}from"./index-CY5VhK_4.js";import{Q as C,a as N}from"./QTh-zacvQ5PI.js";import{Q as P}from"./QMarkupTable-GNksAD2U.js";import{Q as U}from"./QSpace-B1jy978k.js";import{Q as x}from"./QForm-BWUYqdlr.js";import{Q as z}from"./QPage-BjSq3l6J.js";import{C as A}from"./ClosePopup-nVQmPBQH.js";import{h as b}from"./moment-C5S46NFB.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F=["top","middle","bottom"],w=Q({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:s=>F.includes(s)}},setup(s,{slots:e}){const a=V(()=>s.align!==void 0?{verticalAlign:s.align}:null),r=V(()=>{const t=s.outline===!0&&s.color||s.textColor;return`q-badge flex inline items-center no-wrap q-badge--${s.multiLine===!0?"multi":"single"}-line`+(s.outline===!0?" q-badge--outline":s.color!==void 0?` bg-${s.color}`:"")+(t!==void 0?` text-${t}`:"")+(s.floating===!0?" q-badge--floating":"")+(s.rounded===!0?" q-badge--rounded":"")+(s.transparent===!0?" q-badge--transparent":"")});return()=>T("div",{class:r.value,style:a.value,role:"status","aria-label":s.label},O(e.default,s.label!==void 0?[s.label]:[]))}}),L={data(){return{fecha:b().format("YYYY-MM-DD"),salas:[],horarios:[],seleccionadas:{},totalMinutos:0,dialogoReservar:!1,nombre:"",personas:1,adelanto:0,observacion:"",loading:!1,directo:!1}},computed:{fechaText(){const s=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],e=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];return`${s[b(this.fecha).day()]} ${b(this.fecha).date()} de ${e[b(this.fecha).month()]} de ${b(this.fecha).year()}`},tiempoSeleccionado(){const s=Math.floor(this.totalMinutos/60),e=this.totalMinutos%60;return`${String(s).padStart(2,"0")}:${String(e).padStart(2,"0")}`},montoTotal(){return this.totalMinutos/30*5*(this.personas||1)},horaMinima(){return Object.keys(this.seleccionadas).length===0?"-":Object.values(this.seleccionadas).map(e=>b(e,"H:mm")).sort((e,a)=>e.diff(a))[0].format("H:mm")},horaMaxima(){if(Object.keys(this.seleccionadas).length===0)return"-";const s=Object.values(this.seleccionadas).map(a=>b(a,"H:mm")).sort((a,r)=>a.diff(r));return s[s.length-1].add(30,"minutes").format("H:mm")}},methods:{esPrimeraCeldaReserva(s,e){const a=`${s}-${e}`,r=`${s-1}-${e}`;return this.$store.reservas[a]?!this.$store.reservas[r]||this.$store.reservas[r].nombre!==this.$store.reservas[a].nombre:!1},getRowspan(s,e){const a=`${s}-${e}`;if(!this.$store.reservas[a])return 1;let r=1;for(;this.$store.reservas[`${s+r}-${e}`]&&this.$store.reservas[`${s+r}-${e}`].nombre===this.$store.reservas[a].nombre;)r++;return r},getReservas(){this.loading=!0,this.$store.reservas={},this.$axios.get("/reservas",{params:{fecha:this.fecha}}).then(s=>{this.$store.reservas=s.data}).catch(()=>{this.$alert.error("Error al obtener reservas")}).finally(()=>{this.loading=!1})},limpiar(){this.seleccionadas={},this.totalMinutos=0,this.nombre="",this.personas=1,this.adelanto=0,this.observacion=""},clickReserva(){if(this.totalMinutos===0){this.$alert.error("Por favor selecciona al menos 30 minutos.");return}this.dialogoReservar=!0,this.nombre="",this.personas=2,this.adelanto=0,this.observacion="",this.directo=!1},shouldShowCell(s,e){const a=`${s}-${e}`,r=`${s-1}-${e}`;return this.$store.reservas[a]?!(s>0&&this.$store.reservas[r]&&this.$store.reservas[r].nombre===this.$store.reservas[a].nombre):!0},toggleSeleccion(s,e,a){const r=`${s}-${e}`;if(!this.$store.reservas[r]){if(Object.keys(this.seleccionadas).length===0){this.seleccionadas[r]=a,this.calcularTotalMinutos();return}if(Object.keys(this.seleccionadas).length>0){const t=new Set(Object.keys(this.seleccionadas).map(o=>o.split("-")[1]));if(t.size>0&&!t.has(String(e))){this.$alert.error("Debes seleccionar en la misma sala.");return}const i=Object.keys(this.seleccionadas).map(o=>parseInt(o.split("-")[0])).sort((o,c)=>o-c);if(i.length>0){const o=i[i.length-1];if(s!==o+1){this.$alert.error("Debes seleccionar horarios consecutivos.");return}}}this.seleccionadas[r]?delete this.seleccionadas[r]:this.seleccionadas[r]=a,this.calcularTotalMinutos()}},calcularTotalMinutos(){this.totalMinutos=Object.keys(this.seleccionadas).length*30},confirmarReserva(){Object.keys(this.seleccionadas).forEach(r=>{this.$store.reservas[r]={nombre:this.nombre,personas:this.personas,color:"yellow"}});const e=Object.keys(this.seleccionadas)[0].split("-")[1],a=this.salas[e]?.sala||"Desconocida";this.loading=!0,this.$axios.post("/reservas",{nombre:this.nombre,numero_personas:this.personas,observaciones:this.observacion,json:JSON.stringify(this.seleccionadas),sala:a,total:this.montoTotal,adelanto:this.adelanto,tiempo:this.tiempoSeleccionado,horario:`${this.horaMinima} - ${this.horaMaxima}`,fecha:this.fecha,directo:this.directo}).then(()=>{this.$alert.success("Reserva confirmada","Reserva"),this.limpiar(),this.getReservas(),this.dialogoReservar=!1,this.$socket.emit("reservas")}).catch(r=>{this.$alert.error(r.response.data.message,"Error al confirmar reserva")}).finally(()=>{this.loading=!1})}},mounted(){for(let e=0;e<20;e++)this.salas.push({sala:"Sala "+(e+1)});for(let e=8;e<23;e++){let a=`${e}:00`,r=`${e}:30`;this.horarios.push({hora:`${a}-${r}`}),a=`${e}:30`,r=`${e+1}:00`,this.horarios.push({hora:`${a}-${r}`})}this.calcularTotalMinutos(),this.getReservas();let s=this;this.$store.socketReservas||(this.$socket.on("reservas",()=>{s.getReservas()}),this.$store.socketReservas=!0)}},J={class:"row"},K={class:"col-6 col-md-2"},Y={class:"col-6 col-md-2 text-center flex flex-center"},Z={class:"text-bold text-red"},G={class:"col-6 col-md-2 flex flex-center"},W={class:"col-6 col-md-2"},X={class:"col-6 col-md-2 text-right"},I={class:"scroll-body"},ee=["onClick"],se={key:0},te={key:0},oe={class:"text-subtitle2 text-bold"},re={class:"text-red"},ae={class:"text-bold q-mt-md text-blue bg-grey-3"},le={class:"text-bold"},ie={class:"text-red text-bold"};function ne(s,e,a,r,t,i){return h(),$(z,{class:"q-pa-xs"},{default:d(()=>[l(_,{flat:"",bordered:""},{default:d(()=>[l(k,{class:"q-pa-xs"},{default:d(()=>[n("div",J,[n("div",K,[l(g,{modelValue:t.fecha,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.fecha=o),i.getReservas],type:"date",label:"Fecha",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),n("div",Y,[n("div",Z,m(i.fechaText),1)]),n("div",G,[l(p,{color:"green",label:"Reservar",onClick:i.clickReserva,"no-caps":"",icon:"save",size:"11px",loading:t.loading},null,8,["onClick","loading"])]),n("div",W,[l(w,{color:"indigo",class:"q-pa-sm"},{default:d(()=>[v(" Tiempo Seleccionado: "+m(i.tiempoSeleccionado),1)]),_:1})]),n("div",X,[Object.keys(t.seleccionadas).length>0?(h(),$(p,{key:0,color:"red",label:"Limpiar",onClick:i.limpiar,"no-caps":"",icon:"clear",size:"11px"},null,8,["onClick"])):S("",!0)]),e[9]||(e[9]=n("div",{class:"col-6 col-md-2 text-right"},null,-1))]),l(P,{"wrap-cells":"",dense:"",bordered:"",flat:"",separator:"cell",class:"tabla-reservas"},{default:d(()=>[n("thead",null,[n("tr",null,[l(C,{class:"bg-grey text-white sticky-hora"},{default:d(()=>e[10]||(e[10]=[v("Hora")])),_:1}),(h(!0),f(y,null,M(t.salas,o=>(h(),$(C,{class:"bg-blue text-white",key:o.sala},{default:d(()=>[v(m(o.sala),1)]),_:2},1024))),128))])]),n("tbody",I,[(h(!0),f(y,null,M(t.horarios,(o,c)=>(h(),f("tr",{key:c},[l(N,{class:"sticky-hora",style:{padding:"0",margin:"0",border:"0"}},{default:d(()=>[v(m(o.hora),1)]),_:2},1024),(h(!0),f(y,null,M(t.salas,(ce,u)=>(h(),f("td",{key:u,class:R([{"bg-green text-white":t.seleccionadas[`${c}-${u}`]&&!s.$store.reservas[`${c}-${u}`],"bg-red text-white":s.$store.reservas[`${c}-${u}`]?.color==="red","bg-yellow text-black":s.$store.reservas[`${c}-${u}`]?.color==="yellow","bg-grey-3":!t.seleccionadas[`${c}-${u}`]&&!s.$store.reservas[`${c}-${u}`]},"text-center cursor-pointer"]),onClick:de=>i.toggleSeleccion(c,u,o.hora)},[s.$store.reservas[`${c}-${u}`]?(h(),f("div",se,[i.esPrimeraCeldaReserva(c,u)?(h(),f(y,{key:0},[v(m(s.$store.reservas[`${c}-${u}`].nombre)+" ",1),s.$store.reservas[`${c}-${u}`]&&s.$store.reservas[`${c}-${u}`].fecha_confirmacion?(h(),f("div",te,m(s.$store.reservas[`${c}-${u}`].fecha_confirmacion.substring(11,16)),1)):S("",!0)],64)):(h(),f(y,{key:1},[v(" ... ")],64))])):S("",!0)],10,ee))),128))]))),128))])]),_:1})]),_:1})]),_:1}),l(j,{modelValue:t.dialogoReservar,"onUpdate:modelValue":e[8]||(e[8]=o=>t.dialogoReservar=o)},{default:d(()=>[l(_,{style:{"min-width":"250px"}},{default:d(()=>[l(k,{class:"q-pb-none row items-center"},{default:d(()=>[n("div",oe,[v(m(i.fechaText)+" ",1),n("div",re,m(Object.keys(t.seleccionadas).length>0?t.salas[Object.keys(t.seleccionadas)[0].split("-")[1]].sala:"-"),1)]),l(U),l(p,{flat:"",dense:"",round:"",icon:"close",class:"q-ml-auto",onClick:e[1]||(e[1]=o=>t.dialogoReservar=!1)})]),_:1}),l(k,null,{default:d(()=>[l(x,{onSubmit:q(i.confirmarReserva,["prevent"])},{default:d(()=>[l(g,{modelValue:t.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>t.nombre=o),label:"Nombre",dense:"",outlined:"",class:"",rules:[o=>!!o||"Por favor, ingresa un nombre."]},null,8,["modelValue","rules"]),l(g,{modelValue:t.personas,"onUpdate:modelValue":e[3]||(e[3]=o=>t.personas=o),modelModifiers:{number:!0},type:"number",label:"Número de Personas",dense:"",outlined:"",class:"",rules:[o=>o>0||"Por favor, ingresa un número válido."]},null,8,["modelValue","rules"]),l(g,{modelValue:t.adelanto,"onUpdate:modelValue":e[4]||(e[4]=o=>t.adelanto=o),modelModifiers:{number:!0},type:"number",label:"Adelanto",dense:"",outlined:"",class:"",rules:[o=>o>=0||"Por favor, ingresa un número válido."]},null,8,["modelValue","rules"]),l(g,{modelValue:t.observacion,"onUpdate:modelValue":e[5]||(e[5]=o=>t.observacion=o),label:"Observación",dense:"",outlined:"",type:"textarea"},null,8,["modelValue"]),l(B,{modelValue:t.directo,"onUpdate:modelValue":[e[6]||(e[6]=o=>t.directo=o),e[7]||(e[7]=o=>t.adelanto=i.montoTotal)],label:t.directo?"Venta Directa":"Reserva",class:R({"text-primary":t.directo,"text-orange":!t.directo})},null,8,["modelValue","label","class"]),n("div",null,[l(w,{color:"indigo",class:"q-pa-sm"},{default:d(()=>[v(" Horario Seleccionado: Desde "+m(i.horaMinima)+" hasta "+m(i.horaMaxima),1)]),_:1})]),n("div",ae," Tiempo Total: "+m(i.tiempoSeleccionado),1),n("div",le," Monto Total: "+m(i.montoTotal)+" Bs ",1),n("div",ie," Saldo: "+m(i.montoTotal-t.adelanto)+" Bs ",1),l(D,{align:"right"},{default:d(()=>[H(l(p,{flat:"",label:"Cancelar","no-caps":"",loading:t.loading},null,8,["loading"]),[[A]]),l(p,{color:"green",label:"Confirmar","no-caps":"",type:"submit",loading:t.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const $e=E(L,[["render",ne]]);export{$e as default};
