import{v as Q,x as V,j as T,ad as O,c as k,o as h,w as u,a as r,Q as _,e as S,b as c,ap as v,t as m,f as p,a0 as g,a3 as y,a4 as f,a5 as $,a6 as M,a7 as w,h as j,aw as q,aq as B,ar as D,Z as H}from"./index-BeX9x6UV.js";import{Q as R,a as N}from"./QTh-Bqwg0BUk.js";import{Q as U}from"./QMarkupTable-CGqn5OX5.js";import{Q as P}from"./QSpace-D6igJOkQ.js";import{Q as x}from"./QForm-FYMXp0r8.js";import{Q as z}from"./QPage-DMDQwutt.js";import{C as A}from"./ClosePopup-CHCxjfAN.js";import{h as b}from"./moment-C5S46NFB.js";import{_ as E}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F=["top","middle","bottom"],C=Q({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:s=>F.includes(s)}},setup(s,{slots:e}){const l=V(()=>s.align!==void 0?{verticalAlign:s.align}:null),a=V(()=>{const t=s.outline===!0&&s.color||s.textColor;return`q-badge flex inline items-center no-wrap q-badge--${s.multiLine===!0?"multi":"single"}-line`+(s.outline===!0?" q-badge--outline":s.color!==void 0?` bg-${s.color}`:"")+(t!==void 0?` text-${t}`:"")+(s.floating===!0?" q-badge--floating":"")+(s.rounded===!0?" q-badge--rounded":"")+(s.transparent===!0?" q-badge--transparent":"")});return()=>T("div",{class:a.value,style:l.value,role:"status","aria-label":s.label},O(e.default,s.label!==void 0?[s.label]:[]))}}),L={data(){return{fecha:b().format("YYYY-MM-DD"),salas:[],horarios:[],seleccionadas:{},totalMinutos:0,dialogoReservar:!1,nombre:"",personas:1,adelanto:0,observacion:"",loading:!1,directo:!1}},computed:{fechaText(){const s=["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"],e=["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];return`${s[b(this.fecha).day()]} ${b(this.fecha).date()} de ${e[b(this.fecha).month()]} de ${b(this.fecha).year()}`},tiempoSeleccionado(){const s=Math.floor(this.totalMinutos/60),e=this.totalMinutos%60;return`${String(s).padStart(2,"0")}:${String(e).padStart(2,"0")}`},montoTotal(){return this.totalMinutos/30*5*(this.personas||1)},horaMinima(){return Object.keys(this.seleccionadas).length===0?"-":Object.values(this.seleccionadas).map(e=>b(e,"H:mm")).sort((e,l)=>e.diff(l))[0].format("H:mm")},horaMaxima(){if(Object.keys(this.seleccionadas).length===0)return"-";const s=Object.values(this.seleccionadas).map(l=>b(l,"H:mm")).sort((l,a)=>l.diff(a));return s[s.length-1].add(30,"minutes").format("H:mm")}},methods:{getRowspan(s,e){const l=`${s}-${e}`;if(!this.$store.reservas[l])return 1;let a=1;for(;this.$store.reservas[`${s+a}-${e}`]&&this.$store.reservas[`${s+a}-${e}`].nombre===this.$store.reservas[l].nombre;)a++;return a},getReservas(){this.loading=!0,this.$store.reservas={},this.$axios.get("/reservas",{params:{fecha:this.fecha}}).then(s=>{this.$store.reservas=s.data}).catch(()=>{this.$alert.error("Error al obtener reservas")}).finally(()=>{this.loading=!1})},limpiar(){this.seleccionadas={},this.totalMinutos=0,this.nombre="",this.personas=1,this.adelanto=0,this.observacion=""},clickReserva(){if(this.totalMinutos===0){this.$alert.error("Por favor selecciona al menos 30 minutos.");return}this.dialogoReservar=!0,this.nombre="",this.personas=2,this.adelanto=0,this.observacion="",this.directo=!1},shouldShowCell(s,e){const l=`${s}-${e}`,a=`${s-1}-${e}`;return this.$store.reservas[l]?!(s>0&&this.$store.reservas[a]&&this.$store.reservas[a].nombre===this.$store.reservas[l].nombre):!0},toggleSeleccion(s,e,l){const a=`${s}-${e}`;if(!this.$store.reservas[a]){if(Object.keys(this.seleccionadas).length===0){this.seleccionadas[a]=l,this.calcularTotalMinutos();return}if(Object.keys(this.seleccionadas).length>0){const t=new Set(Object.keys(this.seleccionadas).map(o=>o.split("-")[1]));if(t.size>0&&!t.has(String(e))){this.$alert.error("Debes seleccionar en la misma sala.");return}const i=Object.keys(this.seleccionadas).map(o=>parseInt(o.split("-")[0])).sort((o,n)=>o-n);if(i.length>0){const o=i[i.length-1];if(s!==o+1){this.$alert.error("Debes seleccionar horarios consecutivos.");return}}}this.seleccionadas[a]?delete this.seleccionadas[a]:this.seleccionadas[a]=l,this.calcularTotalMinutos()}},calcularTotalMinutos(){this.totalMinutos=Object.keys(this.seleccionadas).length*30},confirmarReserva(){Object.keys(this.seleccionadas).forEach(a=>{this.$store.reservas[a]={nombre:this.nombre,personas:this.personas,color:"yellow"}});const e=Object.keys(this.seleccionadas)[0].split("-")[1],l=this.salas[e]?.sala||"Desconocida";this.loading=!0,this.$axios.post("/reservas",{nombre:this.nombre,numero_personas:this.personas,observaciones:this.observacion,json:JSON.stringify(this.seleccionadas),sala:l,total:this.montoTotal,adelanto:this.adelanto,tiempo:this.tiempoSeleccionado,horario:`${this.horaMinima} - ${this.horaMaxima}`,fecha:this.fecha,directo:this.directo}).then(()=>{this.$alert.success("Reserva confirmada","Reserva"),this.limpiar(),this.getReservas(),this.dialogoReservar=!1,this.$socket.emit("reservas")}).catch(a=>{this.$alert.error(a.response.data.message,"Error al confirmar reserva")}).finally(()=>{this.loading=!1})}},mounted(){for(let e=0;e<20;e++)this.salas.push({sala:"Sala "+(e+1)});for(let e=8;e<23;e++){let l=`${e}:00`,a=`${e}:30`;this.horarios.push({hora:`${l}-${a}`}),l=`${e}:30`,a=`${e+1}:00`,this.horarios.push({hora:`${l}-${a}`})}this.calcularTotalMinutos(),this.getReservas();let s=this;this.$store.socketReservas||(this.$socket.on("reservas",()=>{s.getReservas()}),this.$store.socketReservas=!0)}},J={class:"row"},Y={class:"col-6 col-md-2"},K={class:"col-6 col-md-2 text-center flex flex-center"},Z={class:"text-bold text-red"},G={class:"col-6 col-md-2 flex flex-center"},W={class:"col-6 col-md-2"},X={class:"col-6 col-md-2 text-right"},I={class:"scroll-body"},ee=["rowspan","onClick"],se={key:0},te={key:1},oe={class:"text-subtitle2 text-bold"},ae={class:"text-red"},re={class:"text-bold q-mt-md text-blue bg-grey-3"},le={class:"text-bold"},ie={class:"text-red text-bold"};function ne(s,e,l,a,t,i){return h(),k(z,{class:"q-pa-xs"},{default:u(()=>[r(_,{flat:"",bordered:""},{default:u(()=>[r(S,{class:"q-pa-xs"},{default:u(()=>[c("div",J,[c("div",Y,[r(v,{modelValue:t.fecha,"onUpdate:modelValue":[e[0]||(e[0]=o=>t.fecha=o),i.getReservas],type:"date",label:"Fecha",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),c("div",K,[c("div",Z,m(i.fechaText),1)]),c("div",G,[r(p,{color:"green",label:"Reservar",onClick:i.clickReserva,"no-caps":"",icon:"save",size:"11px",loading:t.loading},null,8,["onClick","loading"])]),c("div",W,[r(C,{color:"indigo",class:"q-pa-sm"},{default:u(()=>[g(" Tiempo Seleccionado: "+m(i.tiempoSeleccionado),1)]),_:1})]),c("div",X,[Object.keys(t.seleccionadas).length>0?(h(),k(p,{key:0,color:"red",label:"Limpiar",onClick:i.limpiar,"no-caps":"",icon:"clear",size:"11px"},null,8,["onClick"])):y("",!0)]),e[9]||(e[9]=c("div",{class:"col-6 col-md-2 text-right"},null,-1))]),r(U,{"wrap-cells":"",dense:"",bordered:"",flat:"",separator:"cell",class:"tabla-reservas"},{default:u(()=>[c("thead",null,[c("tr",null,[r(R,{class:"bg-grey text-white sticky-hora"},{default:u(()=>e[10]||(e[10]=[g("Hora")])),_:1}),(h(!0),f($,null,M(t.salas,o=>(h(),k(R,{class:"bg-blue text-white",key:o.sala},{default:u(()=>[g(m(o.sala),1)]),_:2},1024))),128))])]),c("tbody",I,[(h(!0),f($,null,M(t.horarios,(o,n)=>(h(),f("tr",{key:n},[r(N,{class:"sticky-hora",style:{padding:"0",margin:"0",border:"0"}},{default:u(()=>[g(m(o.hora),1)]),_:2},1024),(h(!0),f($,null,M(t.salas,(ce,d)=>(h(),f($,{key:d},[i.shouldShowCell(n,d)?(h(),f("td",{key:0,rowspan:i.getRowspan(n,d),class:w([{"bg-green text-white":t.seleccionadas[`${n}-${d}`]&&!s.$store.reservas[`${n}-${d}`],"bg-red text-white":s.$store.reservas[`${n}-${d}`]?.color==="red","bg-yellow text-black":s.$store.reservas[`${n}-${d}`]?.color==="yellow","bg-grey-3":!t.seleccionadas[`${n}-${d}`]&&!s.$store.reservas[`${n}-${d}`]},"text-center cursor-pointer"]),onClick:de=>i.toggleSeleccion(n,d,o.hora)},[s.$store.reservas[`${n}-${d}`]?(h(),f("div",se,m(s.$store.reservas[`${n}-${d}`].nombre),1)):y("",!0),s.$store.reservas[`${n}-${d}`]&&s.$store.reservas[`${n}-${d}`].fecha_confirmacion?(h(),f("div",te,m(s.$store.reservas[`${n}-${d}`].fecha_confirmacion.substring(11,16)),1)):y("",!0)],10,ee)):y("",!0)],64))),128))]))),128))])]),_:1})]),_:1})]),_:1}),r(j,{modelValue:t.dialogoReservar,"onUpdate:modelValue":e[8]||(e[8]=o=>t.dialogoReservar=o)},{default:u(()=>[r(_,{style:{"min-width":"250px"}},{default:u(()=>[r(S,{class:"q-pb-none row items-center"},{default:u(()=>[c("div",oe,[g(m(i.fechaText)+" ",1),c("div",ae,m(Object.keys(t.seleccionadas).length>0?t.salas[Object.keys(t.seleccionadas)[0].split("-")[1]].sala:"-"),1)]),r(P),r(p,{flat:"",dense:"",round:"",icon:"close",class:"q-ml-auto",onClick:e[1]||(e[1]=o=>t.dialogoReservar=!1)})]),_:1}),r(S,null,{default:u(()=>[r(x,{onSubmit:q(i.confirmarReserva,["prevent"])},{default:u(()=>[r(v,{modelValue:t.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>t.nombre=o),label:"Nombre",dense:"",outlined:"",class:"",rules:[o=>!!o||"Por favor, ingresa un nombre."]},null,8,["modelValue","rules"]),r(v,{modelValue:t.personas,"onUpdate:modelValue":e[3]||(e[3]=o=>t.personas=o),modelModifiers:{number:!0},type:"number",label:"Número de Personas",dense:"",outlined:"",class:"",rules:[o=>o>0||"Por favor, ingresa un número válido."]},null,8,["modelValue","rules"]),r(v,{modelValue:t.adelanto,"onUpdate:modelValue":e[4]||(e[4]=o=>t.adelanto=o),modelModifiers:{number:!0},type:"number",label:"Adelanto",dense:"",outlined:"",class:"",rules:[o=>o>=0||"Por favor, ingresa un número válido."]},null,8,["modelValue","rules"]),r(v,{modelValue:t.observacion,"onUpdate:modelValue":e[5]||(e[5]=o=>t.observacion=o),label:"Observación",dense:"",outlined:"",type:"textarea"},null,8,["modelValue"]),r(B,{modelValue:t.directo,"onUpdate:modelValue":[e[6]||(e[6]=o=>t.directo=o),e[7]||(e[7]=o=>t.adelanto=i.montoTotal)],label:t.directo?"Venta Directa":"Reserva",class:w({"text-primary":t.directo,"text-orange":!t.directo})},null,8,["modelValue","label","class"]),c("div",null,[r(C,{color:"indigo",class:"q-pa-sm"},{default:u(()=>[g(" Horario Seleccionado: Desde "+m(i.horaMinima)+" hasta "+m(i.horaMaxima),1)]),_:1})]),c("div",re," Tiempo Total: "+m(i.tiempoSeleccionado),1),c("div",le," Monto Total: "+m(i.montoTotal)+" Bs ",1),c("div",ie," Saldo: "+m(i.montoTotal-t.adelanto)+" Bs ",1),r(D,{align:"right"},{default:u(()=>[H(r(p,{flat:"",label:"Cancelar","no-caps":"",loading:t.loading},null,8,["loading"]),[[A]]),r(p,{color:"green",label:"Confirmar","no-caps":"",type:"submit",loading:t.loading},null,8,["loading"])]),_:1})]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}const $e=E(L,[["render",ne]]);export{$e as default};
