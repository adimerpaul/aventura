import{ay as R,g as U,r as s,V as E,k as F,c as B,o as i,w as o,b as l,a,f as v,Q as _,e as Q,an as C,a$ as M,u as T,a1 as b,a2 as k,a3 as $,W as O,Z as x,t as u,_ as W,am as Z,h as j,au as G}from"./index-BCEHSGBj.js";import{c as H,Q as J,a as I,b as h}from"./QList-DquoUKNy.js";import{Q as K}from"./QMarkupTable-CgVrH0X8.js";import{Q as X}from"./QForm-Dun49YRB.js";import{Q as Y}from"./QPage-B9wyOFgf.js";const ee={class:"row"},ae={class:"col-12"},le={class:"col-12 col-md-7"},te={class:"col-12 col-md-5"},oe={class:"text-bold"},ce={__name:"VentaAdd",setup(ne){const P=R(),{proxy:c}=U(),f=s({nombre:"",fecha:new Date().toISOString().slice(0,10)}),V=s([]),w=s([]),r=s([]);let d=s("");const p=s(!1),m=s(!1);E(()=>{z()});function z(){c.$axios.get("/productos").then(n=>{V.value=n.data,w.value=n.data})}const y=F(()=>r.value.reduce((n,t)=>n+t.cantidadVenta*t.precioVenta,0).toFixed(2));function D(){V.value=w.value.filter(n=>n.nombre.toLowerCase().includes(d.value.toLowerCase()))}function q(n){const t=r.value.find(e=>e.id===n.id);t?t.cantidadVenta++:r.value.push({...n,cantidadVenta:1,precioVenta:n.precio})}function A(n){r.value.splice(n,1)}function L(){if(r.value.length===0){c.$alert.error("El carrito está vacío","Error");return}p.value=!0,f.value={nombre:"SN"}}function N(){if(r.value.length===0){c.$alert.error("El carrito está vacío");return}m.value=!0,c.$axios.post("/ventas",{...f.value,total:y.value,productos:r.value}).then(async()=>{r.value=[],f.value={nombre:"",fecha:new Date().toISOString().slice(0,10)},p.value=!1,c.$alert.success("Venta realizada con éxito","Éxito"),P.push("/ventas"),d.value=""}).finally(()=>{m.value=!1})}return(n,t)=>(i(),B(Y,{class:"q-pa-xs"},{default:o(()=>[l("div",ee,[l("div",ae,[a(v,{label:"Atras",color:"primary",onClick:t[0]||(t[0]=e=>n.$router.push("/ventas")),"no-caps":"",icon:"arrow_back"})]),l("div",le,[a(_,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[a(Q,null,{default:o(()=>[a(C,{modelValue:T(d),"onUpdate:modelValue":[t[1]||(t[1]=e=>M(d)?d.value=e:d=e),D],label:"Buscar producto",outlined:"",dense:"",debounce:"300"},null,8,["modelValue"]),a(H,{bordered:"",padding:"",dense:""},{default:o(()=>[(i(!0),b(k,null,$(V.value,e=>(i(),b(k,{key:e.id},[O((i(),B(J,{clickable:"",onClick:g=>q(e)},{default:o(()=>[a(I,null,{default:o(()=>[a(h,null,{default:o(()=>[x(u(e.nombre),1)]),_:2},1024),a(h,{caption:""},{default:o(()=>[x(u(e.precio)+" Bs",1)]),_:2},1024)]),_:2},1024),a(I,{side:""},{default:o(()=>[a(h,{caption:""},{default:o(()=>[x(u(e.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[W]]),a(Z,{spaced:"",inset:""})],64))),128))]),_:1})]),_:1})]),_:1})]),l("div",te,[a(_,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[a(Q,null,{default:o(()=>[a(K,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[t[6]||(t[6]=l("thead",null,[l("tr",null,[l("th",null,"Producto"),l("th",null,"Cantidad"),l("th",null,"Precio"),l("th",null,"Subtotal"),l("th",null,"Acciones")])],-1)),l("tbody",null,[(i(!0),b(k,null,$(r.value,(e,g)=>(i(),b("tr",{key:g},[l("td",null,u(e.nombre),1),l("td",null,[a(C,{modelValue:e.cantidadVenta,"onUpdate:modelValue":S=>e.cantidadVenta=S,modelModifiers:{number:!0},type:"number",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),l("td",null,u(e.precio)+" Bs ",1),l("td",null,u((e.cantidadVenta*e.precioVenta).toFixed(2))+" Bs",1),l("td",null,[a(v,{icon:"delete",color:"red",dense:"",onClick:S=>A(g),loading:m.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),l("tfoot",null,[l("tr",null,[t[4]||(t[4]=l("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),l("td",oe,u(y.value)+" Bs",1),t[5]||(t[5]=l("td",null,null,-1))])])]),_:1}),a(v,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:L,loading:m.value},null,8,["loading"])]),_:1})]),_:1})])]),a(j,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=e=>p.value=e)},{default:o(()=>[a(_,{flat:"",bordered:""},{default:o(()=>[a(Q,null,{default:o(()=>[a(X,{onSubmit:G(N,["prevent"])},{default:o(()=>[a(C,{modelValue:f.value.nombre,"onUpdate:modelValue":t[2]||(t[2]=e=>f.value.nombre=e),label:"Nombre Cliente",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),a(v,{label:"Realizar Venta",color:"positive",type:"submit","no-caps":"",loading:m.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{ce as default};
