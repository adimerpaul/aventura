import{at as F,g as U,r as i,V as M,k as T,c as Q,o as r,w as o,b as l,a as t,f,Q as k,e as g,a5 as w,au as O,u as j,a1 as c,a2 as x,a3 as y,W,Z as C,t as u,a0 as z,_ as Z,a7 as G,h as H,as as J}from"./index-D4Q0ew6z.js";import{c as K,Q as X,a as P,b as S}from"./QList-Cob0vwMU.js";import{Q as Y}from"./QChip-DdBveP1c.js";import{Q as I}from"./QSpace-Duqy0kKz.js";import{Q as ee}from"./QMarkupTable-BbBgKwsy.js";import{Q as ae}from"./QForm-CIlPEVtn.js";import{Q as le}from"./QPage-DYVe3qcD.js";const te={class:"row"},oe={class:"col-12"},ne={class:"col-12 col-md-7"},se={class:"text-grey text-caption"},re={key:0},ue={key:1,class:"text-blue"},de={class:"col-12 col-md-5"},ie={class:"div"},ce={class:"text-h6 row items-center"},pe={class:"text-bold"},_e={__name:"VentaAdd",setup(me){const q=F(),{proxy:p}=U(),b=i({nombre:"",fecha:new Date().toISOString().slice(0,10)}),_=i([]),$=i([]),s=i([]);let m=i("");const V=i(!1),v=i(!1);M(()=>{A()});function A(){p.$axios.get("/productos").then(n=>{_.value=n.data,$.value=n.data})}const B=T(()=>s.value.reduce((n,e)=>n+e.cantidadVenta*e.precioVenta,0).toFixed(2));function D(){_.value=$.value.filter(n=>n.nombre.toLowerCase().includes(m.value.toLowerCase()))}function L(n){const e=s.value.find(a=>a.id===n.id);e?e.cantidadVenta++:s.value.push({...n,cantidadVenta:1,precioVenta:n.precio})}function N(n){s.value.splice(n,1)}function R(){if(s.value.length===0){p.$alert.error("El carrito está vacío","Error");return}V.value=!0,b.value={nombre:"SN"}}function E(){if(s.value.length===0){p.$alert.error("El carrito está vacío");return}v.value=!0,p.$axios.post("/ventas",{...b.value,total:B.value,productos:s.value}).then(async()=>{s.value=[],b.value={nombre:"",fecha:new Date().toISOString().slice(0,10)},V.value=!1,p.$alert.success("Venta realizada con éxito","Éxito"),q.push("/ventas"),m.value=""}).catch(n=>{p.$alert.error(n.response.data.message,"Error")}).finally(()=>{v.value=!1})}return(n,e)=>(r(),Q(le,{class:"q-pa-xs"},{default:o(()=>[l("div",te,[l("div",oe,[t(f,{label:"Atras",color:"primary",onClick:e[0]||(e[0]=a=>n.$router.push("/ventas")),"no-caps":"",icon:"arrow_back"})]),l("div",ne,[t(k,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[t(g,null,{default:o(()=>[t(w,{modelValue:j(m),"onUpdate:modelValue":[e[1]||(e[1]=a=>O(m)?m.value=a:m=a),D],label:"Buscar producto",outlined:"",dense:"",debounce:"300"},null,8,["modelValue"]),t(K,{bordered:"",padding:"",dense:""},{default:o(()=>[(r(!0),c(x,null,y(_.value,a=>(r(),c(x,{key:a.id},[W((r(),Q(X,{clickable:"",onClick:d=>L(a)},{default:o(()=>[t(P,null,{default:o(()=>[t(S,null,{default:o(()=>[C(u(a.nombre)+" ",1),l("span",se," ("+u(a.agencia)+") ",1)]),_:2},1024),t(S,{caption:""},{default:o(()=>[a.producto_combo.length>0?(r(),c("span",re,[(r(!0),c(x,null,y(a.producto_combo,d=>(r(),Q(Y,{key:d.id,label:d.cantidad+" "+d.producto_hijo.nombre,dense:""},null,8,["label"]))),128))])):z("",!0),C(" "+u(a.precio)+" Bs ",1),a.precio-a.precio_compra>0&&n.$store.user.role==="Admin"?(r(),c("span",ue," (+"+u((a.precio-a.precio_compra).toFixed(2))+" Bs) ",1)):z("",!0)]),_:2},1024)]),_:2},1024),t(P,{side:""},{default:o(()=>[t(S,{caption:"",class:""},{default:o(()=>[e[6]||(e[6]=C(" Cant ")),e[7]||(e[7]=l("br",null,null,-1)),C(" "+u(a.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[Z]]),t(G,{spaced:"",inset:""})],64))),128))]),_:1})]),_:1})]),_:1})]),l("div",de,[t(k,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[t(g,null,{default:o(()=>[l("div",ie,[l("div",ce,[e[8]||(e[8]=l("div",null,"Carrito",-1)),t(I),t(f,{icon:"delete",color:"red",dense:"",onClick:e[2]||(e[2]=a=>s.value=[]),loading:v.value,size:"10px",label:"Limpiar","no-caps":""},null,8,["loading"])]),e[9]||(e[9]=l("div",{class:"text-caption"},"Productos agregados al carrito",-1))]),t(ee,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[e[12]||(e[12]=l("thead",null,[l("tr",{class:"bg-primary text-white"},[l("th",null,"Producto"),l("th",null,"Cantidad"),l("th",null,"Precio"),l("th",null,"Subtotal"),l("th",null,"Acciones")])],-1)),l("tbody",null,[(r(!0),c(x,null,y(s.value,(a,d)=>(r(),c("tr",{key:d},[l("td",null,u(a.nombre),1),l("td",null,[t(w,{modelValue:a.cantidadVenta,"onUpdate:modelValue":h=>a.cantidadVenta=h,modelModifiers:{number:!0},type:"number",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),l("td",null,u(a.precio)+" Bs ",1),l("td",null,u((a.cantidadVenta*a.precioVenta).toFixed(2))+" Bs",1),l("td",null,[t(f,{icon:"delete",color:"red",dense:"",onClick:h=>N(d),loading:v.value,size:"10px"},null,8,["onClick","loading"])])]))),128))]),l("tfoot",null,[l("tr",null,[e[10]||(e[10]=l("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),l("td",pe,u(B.value)+" Bs",1),e[11]||(e[11]=l("td",null,null,-1))])])]),_:1}),t(f,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:R,loading:v.value},null,8,["loading"])]),_:1})]),_:1})])]),t(H,{modelValue:V.value,"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a)},{default:o(()=>[t(k,{flat:"",bordered:""},{default:o(()=>[t(g,{class:"q-pb-none row items-center"},{default:o(()=>[e[13]||(e[13]=l("div",{class:"text-bold"}," Realizar Venta ",-1)),t(I),t(f,{flat:"",dense:"",round:"",icon:"close",onClick:e[3]||(e[3]=a=>V.value=!1)})]),_:1}),t(g,null,{default:o(()=>[t(ae,{onSubmit:J(E,["prevent"])},{default:o(()=>[t(w,{modelValue:b.value.nombre,"onUpdate:modelValue":e[4]||(e[4]=a=>b.value.nombre=a),label:"Nombre Cliente",outlined:"",dense:"",rules:[a=>!!a||"Campo requerido"]},null,8,["modelValue","rules"]),t(f,{label:"Realizar Venta",color:"positive",type:"submit","no-caps":"",loading:v.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{_e as default};
