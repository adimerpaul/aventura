import{g as L,r as u,V as M,k as N,c as $,o as d,w as o,b as l,a,f as V,Q as C,e as k,aB as b,a_ as E,u as F,a1 as g,a2 as x,a3 as I,W as R,Z as w,t as i,_ as T,aA as O,h as W,aW as Z}from"./index-DEbtOr7C.js";import{c as j,Q as G,a as P,b as h}from"./QList-3trESrqO.js";import{Q as H}from"./QMarkupTable-rH2VDkqn.js";import{Q as J}from"./QForm-BIWJhDDX.js";import{Q as K}from"./QPage-BHsL5-dn.js";const X={class:"row"},Y={class:"col-12"},ee={class:"col-12 col-md-7"},ae={class:"col-12 col-md-5"},le={class:"text-bold"},de={__name:"VentaAdd",setup(te){const{proxy:c}=L(),m=u({nombre:"",fecha:new Date().toISOString().slice(0,10)}),_=u([]),y=u([]),r=u([]);let s=u("");const p=u(!1),f=u(!1);M(()=>{S()});function S(){c.$axios.get("/productos").then(n=>{_.value=n.data,y.value=n.data})}const B=N(()=>r.value.reduce((n,t)=>n+t.cantidadVenta*t.precioVenta,0).toFixed(2));function U(){_.value=y.value.filter(n=>n.nombre.toLowerCase().includes(s.value.toLowerCase()))}function A(n){const t=r.value.find(e=>e.id===n.id);t?t.cantidadVenta++:r.value.push({...n,cantidadVenta:1,precioVenta:n.precio})}function D(n){r.value.splice(n,1)}function q(){if(r.value.length===0){c.$alert.error("El carrito está vacío","Error");return}p.value=!0,m.value={nombre:"SN"}}function z(){if(r.value.length===0){c.$alert.error("El carrito está vacío");return}f.value=!0,c.$axios.post("/ventas",{...m.value,total:B.value,productos:r.value}).then(async()=>{r.value=[],m.value={nombre:"",fecha:new Date().toISOString().slice(0,10)},p.value=!1,c.$alert.success("Venta realizada con éxito","Éxito"),await S(),s.value=""}).finally(()=>{f.value=!1})}return(n,t)=>(d(),$(K,{class:"q-pa-xs"},{default:o(()=>[l("div",X,[l("div",Y,[a(V,{label:"Atras",color:"primary",onClick:t[0]||(t[0]=e=>n.$router.push("/ventas")),"no-caps":"",icon:"arrow_back"})]),l("div",ee,[a(C,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[a(k,null,{default:o(()=>[a(b,{modelValue:F(s),"onUpdate:modelValue":[t[1]||(t[1]=e=>E(s)?s.value=e:s=e),U],label:"Buscar producto",outlined:"",dense:"",debounce:"300"},null,8,["modelValue"]),a(j,{bordered:"",padding:"",dense:""},{default:o(()=>[(d(!0),g(x,null,I(_.value,e=>(d(),g(x,{key:e.id},[R((d(),$(G,{clickable:"",onClick:Q=>A(e)},{default:o(()=>[a(P,null,{default:o(()=>[a(h,null,{default:o(()=>[w(i(e.nombre),1)]),_:2},1024),a(h,{caption:""},{default:o(()=>[w(i(e.precio)+" Bs",1)]),_:2},1024)]),_:2},1024),a(P,{side:""},{default:o(()=>[a(h,{caption:""},{default:o(()=>[w(i(e.stock),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])),[[T]]),a(O,{spaced:"",inset:""})],64))),128))]),_:1})]),_:1})]),_:1})]),l("div",ae,[a(C,{flat:"",bordered:"",class:"q-ma-xs"},{default:o(()=>[a(k,null,{default:o(()=>[a(H,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:o(()=>[t[6]||(t[6]=l("thead",null,[l("tr",null,[l("th",null,"Producto"),l("th",null,"Cantidad"),l("th",null,"Precio"),l("th",null,"Subtotal"),l("th",null,"Acciones")])],-1)),l("tbody",null,[(d(!0),g(x,null,I(r.value,(e,Q)=>(d(),g("tr",{key:Q},[l("td",null,i(e.nombre),1),l("td",null,[a(b,{modelValue:e.cantidadVenta,"onUpdate:modelValue":v=>e.cantidadVenta=v,modelModifiers:{number:!0},type:"number",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),l("td",null,[a(b,{modelValue:e.precioVenta,"onUpdate:modelValue":v=>e.precioVenta=v,modelModifiers:{number:!0},type:"number",dense:"",outlined:""},null,8,["modelValue","onUpdate:modelValue"])]),l("td",null,i((e.cantidadVenta*e.precioVenta).toFixed(2))+" Bs",1),l("td",null,[a(V,{icon:"delete",color:"red",dense:"",onClick:v=>D(Q),loading:f.value},null,8,["onClick","loading"])])]))),128))]),l("tfoot",null,[l("tr",null,[t[4]||(t[4]=l("td",{colspan:"3",class:"text-right text-bold"},"Total",-1)),l("td",le,i(B.value)+" Bs",1),t[5]||(t[5]=l("td",null,null,-1))])])]),_:1}),a(V,{label:"Realizar Venta",color:"positive",class:"full-width q-mt-md","no-caps":"",onClick:q,loading:f.value},null,8,["loading"])]),_:1})]),_:1})])]),a(W,{modelValue:p.value,"onUpdate:modelValue":t[3]||(t[3]=e=>p.value=e)},{default:o(()=>[a(C,{flat:"",bordered:""},{default:o(()=>[a(k,null,{default:o(()=>[a(J,{onSubmit:Z(z,["prevent"])},{default:o(()=>[a(b,{modelValue:m.value.nombre,"onUpdate:modelValue":t[2]||(t[2]=e=>m.value.nombre=e),label:"Nombre Cliente",outlined:"",dense:"",rules:[e=>!!e||"Campo requerido"]},null,8,["modelValue","rules"]),a(V,{label:"Realizar Venta",color:"positive",type:"submit","no-caps":"",loading:f.value},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{de as default};
