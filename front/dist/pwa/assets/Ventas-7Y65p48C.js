import{g as oe,r as u,l as te,a4 as c,o as s,a as l,b as a,w as t,Q as j,e as S,as as N,ap as A,c as m,a3 as v,f as y,Z as U,a2 as I,t as r,a0 as V,a1 as D,a5 as M,a6 as R,h as ne}from"./index-DPNgNDZA.js";import{Q as E}from"./QSelect-CcegbZfQ.js";import{Q as J}from"./QForm-CUicyxGw.js";import{d as L,Q as T,a as f,b as _,c as se}from"./QList-i4w7QsLv.js";import{Q as ie}from"./QMarkupTable-PcfD26Ti.js";import{Q as de}from"./QPage-DM39pZUv.js";import{Q as ue}from"./QSpace-TTilL_Gy.js";import{h as G}from"./moment-C5S46NFB.js";import{I as O}from"./impresion-UazNtpnb.js";import"./format-mnsSgzCt.js";const re={class:"row"},ce={class:"col-12 col-md-2"},pe={class:"col-12 col-md-2"},me={class:"col-12 col-md-2"},ve={class:"col-12 col-md-2 flex flex-center"},fe={class:"col-12 col-md-2"},_e={class:"col-12 col-md-2 flex flex-center"},be={class:"col-12 col-md-4"},xe={class:"col-12 col-md-2 flex flex-center"},ge={class:"col-12 col-md-2 flex flex-center"},he={class:"row"},ye={class:"col-12 col-md-3 q-pa-xs"},Ce={class:"text-weight-bold"},we={class:"col-12 col-md-3 q-pa-xs"},Ve={class:"text-weight-bold"},ke={class:"col-12 col-md-3 q-pa-xs"},Qe={class:"text-weight-bold"},Ae={class:"col-12 col-md-3 q-pa-xs"},$e={class:"text-weight-bold"},Fe={key:1},Se={style:{"max-width":"200px","wrap-option":"wrap"}},Ue={key:0},Ie={key:1},De={key:0,class:"text-blue"},Le={key:2},Je={__name:"Ventas",setup(Te){const{proxy:p}=oe(),b=u(G().format("YYYY-MM-DD")),x=u(G().format("YYYY-MM-DD")),g=u([]),Y=u([]),d=u(!1),k=u(""),$=u([]),C=u(""),h=u("CAJA"),Q=u(!1),w=u({}),P=u([]),z=u(["CAJA","PRODUCTOS","SALA"]);te(()=>{q(),le(),Z()});function Z(){p.$axios.get("/productos").then(n=>{P.value=n.data})}function H(){if(!C.value&&h.value!=="PRODUCTOS"){p.$alert.error("Seleccione un usuario","Por favor");return}d.value=!0;const n=$.value.find(e=>e.id===C.value);p.$axios.post("/ventas/imprimir",{user_id:C.value,fechaInicio:b.value,fechaFin:x.value,reporte:h.value}).then(e=>{h.value==="CAJA"&&O.imprimirCaja(e.data,b.value,x.value,n.name),h.value==="PRODUCTOS"&&O.imprimirProductos(e.data,b.value,x.value,n.name,P.value),h.value==="SALA"&&O.imprimirSalas(e.data,b.value,x.value,n.name)}).finally(()=>{d.value=!1})}function K(){Q.value=!0,w.value={monto_inicial:0,monto_final:0,observacion:""}}function W(){d.value=!0,p.$axios.post("/cajas",w.value).then(n=>{Q.value=!1,p.$alert.success("Registrado correctamente",n.data)}).finally(()=>{d.value=!1})}function X(){g.value=Y.value.filter(n=>n.nombre.toLowerCase().includes(k.value.toLowerCase())||n.user?.name.toLowerCase().includes(k.value.toLowerCase())||n.detalleText.toLowerCase().includes(k.value.toLowerCase()))}function ee(n){p.$q.dialog({title:"Anular Venta",message:"¿Está seguro de anular la venta?",ok:"Sí",cancel:"No"}).onOk(()=>{d.value=!0,p.$axios.put(`/ventas/${n}/anular`).then(()=>{q()}).finally(()=>{d.value=!1})})}function le(){$.value=[{id:"",name:"Todos"}],p.$axios.get("/usersSucursal").then(n=>{n.data.forEach(e=>{$.value.push({id:e.id,name:e.name})})})}function q(){d.value=!0,p.$axios.get("/ventas",{params:{fechaInicio:b.value,fechaFin:x.value,user_id:C.value}}).then(n=>{g.value=n.data,Y.value=n.data}).finally(()=>{d.value=!1})}return(n,e)=>(s(),c(M,null,[l(de,{class:"q-pa-xs"},{default:t(()=>[l(j,{flat:"",bordered:""},{default:t(()=>[l(S,{class:"q-pa-xs"},{default:t(()=>[l(J,{onSubmit:N(q,["prevent"])},{default:t(()=>[a("div",re,[a("div",ce,[l(A,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",pe,[l(A,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=o=>x.value=o),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",me,[n.$store.user.role==="Admin"?(s(),m(E,{key:0,modelValue:C.value,"onUpdate:modelValue":e[2]||(e[2]=o=>C.value=o),label:"Usuario",outlined:"",dense:"",options:$.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):v("",!0)]),a("div",ve,[l(y,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:d.value},null,8,["loading"])]),a("div",fe,[n.$store.user.role==="Admin"?(s(),m(E,{key:0,modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=o=>h.value=o),label:"Tipo Reporte",outlined:"",dense:"",options:z.value},null,8,["modelValue","options"])):v("",!0)]),a("div",_e,[n.$store.user.role==="Admin"?(s(),m(y,{key:0,style:{width:"150px"},label:"Imprimir",color:"indigo",icon:"print","no-caps":"",loading:d.value,onClick:H},null,8,["loading"])):v("",!0)]),e[10]||(e[10]=a("div",{class:"col-12 col-md-12 flex flex-center"},null,-1)),a("div",be,[l(A,{modelValue:k.value,"onUpdate:modelValue":[e[4]||(e[4]=o=>k.value=o),X],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])]),a("div",xe,[l(y,{style:{width:"150px"},label:"Venta",color:"positive",onClick:e[5]||(e[5]=o=>n.$router.push("/ventas/add")),"no-caps":"",icon:"add_circle_outline",loading:d.value},null,8,["loading"])]),e[11]||(e[11]=a("div",{class:"col-12 col-md-4 flex flex-center"},null,-1)),a("div",ge,[l(y,{style:{width:"150px"},label:"Cerrar Caja",color:"red",onClick:K,"no-caps":"",icon:"point_of_sale",loading:d.value},null,8,["loading"])])])]),_:1}),a("div",he,[a("div",ye,[l(L,{bordered:"",padding:"",dense:""},{default:t(()=>[U((s(),m(T,{clickable:""},{default:t(()=>[l(f,{avatar:""},{default:t(()=>[l(I,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),l(f,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",Ce,r(g.value.length)+" ventas ",1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[12]||(e[12]=[V(" Cantida de ventas ")])),_:1})]),_:1})]),_:1})),[[D]])]),_:1})]),a("div",we,[n.$store.user.role==="Admin"?(s(),m(L,{key:0,bordered:"",padding:"",dense:""},{default:t(()=>[U((s(),m(T,{clickable:""},{default:t(()=>[l(f,{avatar:""},{default:t(()=>[l(I,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(f,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",Ve," Bs "+r(g.value.filter(o=>!o.anulada).reduce((o,i)=>o+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[13]||(e[13]=[V(" Total de ventas ")])),_:1})]),_:1})]),_:1})),[[D]])]),_:1})):v("",!0)]),a("div",ke,[l(L,{bordered:"",padding:"",dense:""},{default:t(()=>[U((s(),m(T,{clickable:""},{default:t(()=>[l(f,{avatar:""},{default:t(()=>[l(I,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(f,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",Qe," Bs "+r(g.value.filter(o=>o.anulada).reduce((o,i)=>o+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[14]||(e[14]=[V(" Total de reservas canceladas ")])),_:1})]),_:1})]),_:1})),[[D]])]),_:1})]),a("div",Ae,[l(L,{bordered:"",padding:"",dense:""},{default:t(()=>[U((s(),m(T,{clickable:""},{default:t(()=>[l(f,{avatar:""},{default:t(()=>[l(I,{color:"amber","text-color":"white",icon:"trending_up"})]),_:1}),l(f,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",$e," Bs "+r(g.value.filter(o=>!o.anulada).reduce((o,i)=>o+i.detalles.reduce((F,B)=>{const ae=B.precio-(B.precio_compra||0);return F+ae*B.cantidad},0),0).toFixed(2)),1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[15]||(e[15]=[V(" Ganancia total ")])),_:1})]),_:1})]),_:1})),[[D]])]),_:1})])])]),_:1})]),_:1}),l(j,{flat:"",bordered:"",class:"q-mt-md"},{default:t(()=>[l(S,null,{default:t(()=>[l(ie,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:t(()=>[e[16]||(e[16]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Acciones"),a("th",null,"Fecha"),a("th",null,"Total"),a("th",null,"Nombre Cliente"),a("th",null,"Usuario"),a("th",null,"Detalle"),a("th",null,"Agencia")])],-1)),a("tbody",null,[(s(!0),c(M,null,R(g.value,o=>(s(),c("tr",{key:o.id},[a("td",null,[o.anulada?(s(),c("div",Fe,[l(se,{color:"red","text-color":"white",label:"Anulada"})])):(s(),m(y,{key:0,style:{width:"80px"},icon:"remove_circle_outline",color:"negative",dense:"",onClick:i=>ee(o.id),label:"Anular","no-caps":"",size:"10px"},null,8,["onClick"]))]),a("td",null,r(o.fecha),1),a("td",null,r(o.total),1),a("td",null,r(o.nombre),1),a("td",null,r(o.user?.name),1),a("td",null,[a("div",Se,[(s(!0),c(M,null,R(o.detalles,(i,F)=>(s(),c("span",{key:F},[F>0?(s(),c("span",Ue,", ")):v("",!0),V(" "+r(i.producto)+" ("+r(i.cantidad)+") ",1),i.precio>0?(s(),c("span",Ie,[V(" Bs "+r(i.precio.toFixed(2))+" ",1),n.$store.user.role==="Admin"?(s(),c("span",De,r(i.precio-i.precio_compra>0?`(+${(i.precio-i.precio_compra).toFixed(2)})`:""),1)):v("",!0)])):v("",!0),i.precio===0?(s(),c("span",Le,"Gratis")):v("",!0)]))),128))])]),a("td",null,r(o.agencia),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(ne,{modelValue:Q.value,"onUpdate:modelValue":e[9]||(e[9]=o=>Q.value=o),persistent:""},{default:t(()=>[l(j,{flat:"",bordered:"",style:{width:"350px"}},{default:t(()=>[l(S,{class:"row items-center q-pb-none"},{default:t(()=>[e[17]||(e[17]=a("div",{class:"text-bold"}," Cerrar Caja ",-1)),l(ue),l(y,{flat:"",dense:"",icon:"close",onClick:e[6]||(e[6]=o=>Q.value=!1)})]),_:1}),l(S,null,{default:t(()=>[l(J,{onSubmit:N(W,["prevent"])},{default:t(()=>[l(A,{modelValue:w.value.monto_final,"onUpdate:modelValue":e[7]||(e[7]=o=>w.value.monto_final=o),label:"Monto Final",type:"number",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(A,{type:"textarea",modelValue:w.value.observacion,"onUpdate:modelValue":e[8]||(e[8]=o=>w.value.observacion=o),label:"Observación",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(y,{label:"Cerrar Caja",color:"red",type:"submit",loading:d.value,"no-caps":"",icon:"point_of_sale",class:"q-mt-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[18]||(e[18]=a("div",{id:"myElement",class:"hidden"},null,-1))],64))}};export{Je as default};
