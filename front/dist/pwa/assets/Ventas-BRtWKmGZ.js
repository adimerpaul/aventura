import{g as ae,r,l as oe,x as te,a4 as c,o as n,a as l,b as a,w as t,Q as q,e as F,as as P,ap as A,c as p,a3 as f,f as y,Z as S,a2 as U,t as d,a0 as C,a1 as I,a5 as B,a6 as E,h as se}from"./index-WGDN3iW5.js";import{Q as N}from"./QSelect-MUIfgsG3.js";import{Q as R}from"./QForm-DL2L5zcI.js";import{d as D,Q as L,a as v,b as _,c as ne}from"./QList-ftl6A0g-.js";import{Q as ie}from"./QMarkupTable-Dh9OlRQT.js";import{Q as de}from"./QPage-CzI-8C-K.js";import{Q as ue}from"./QSpace-B89ZPcb_.js";import{h as J}from"./moment-C5S46NFB.js";import{I as j}from"./impresion-BFjv822S.js";import"./format-CbPrzBGq.js";const re={class:"row"},ce={class:"col-12 col-md-2"},me={class:"col-12 col-md-2"},pe={class:"col-12 col-md-2"},fe={class:"col-12 col-md-2 flex flex-center"},ve={class:"col-12 col-md-2"},_e={class:"col-12 col-md-2 flex flex-center"},be={class:"col-12 col-md-4"},xe={class:"col-12 col-md-2 flex flex-center"},he={class:"col-12 col-md-2 flex flex-center"},ge={class:"row"},ye={class:"col-12 col-md-3 q-pa-xs"},Ce={class:"text-weight-bold"},we={class:"col-12 col-md-3 q-pa-xs"},Ve={class:"text-weight-bold"},ke={class:"col-12 col-md-3 q-pa-xs"},Qe={class:"text-weight-bold"},Ae={class:"col-12 col-md-3 q-pa-xs"},$e={class:"text-weight-bold"},Fe={key:1},Se={style:{"max-width":"200px","wrap-option":"wrap"}},Ue={key:0},Ie={key:1},De={key:0,class:"text-blue"},Le={key:2},Je={__name:"Ventas",setup(Te){const{proxy:m}=ae(),b=r(J().format("YYYY-MM-DD")),x=r(J().format("YYYY-MM-DD")),h=r([]),M=r([]),u=r(!1),k=r(""),$=r([]),w=r(""),g=r("CAJA"),Q=r(!1),V=r({}),O=r([]),G=r(["CAJA","PRODUCTOS","SALA"]);oe(()=>{T(),ee(),z()});function z(){m.$axios.get("/productos").then(s=>{O.value=s.data})}function Z(){if(!w.value&&g.value!=="PRODUCTOS"){m.$alert.error("Seleccione un usuario","Por favor");return}u.value=!0;const s=$.value.find(e=>e.id===w.value);m.$axios.post("/ventas/imprimir",{user_id:w.value,fechaInicio:b.value,fechaFin:x.value,reporte:g.value}).then(e=>{g.value==="CAJA"&&j.imprimirCaja(e.data,b.value,x.value,s.name),g.value==="PRODUCTOS"&&j.imprimirProductos(e.data,b.value,x.value,s.name,O.value),g.value==="SALA"&&j.imprimirSalas(e.data,b.value,x.value,s.name)}).finally(()=>{u.value=!1})}function H(){Q.value=!0,V.value={monto_inicial:0,monto_final:0,observacion:""}}function K(){u.value=!0,m.$axios.post("/cajas",V.value).then(s=>{Q.value=!1,m.$alert.success("Registrado correctamente",s.data)}).finally(()=>{u.value=!1})}function W(){h.value=M.value.filter(s=>s.nombre.toLowerCase().includes(k.value.toLowerCase())||s.user?.name.toLowerCase().includes(k.value.toLowerCase())||s.detalleText.toLowerCase().includes(k.value.toLowerCase()))}function X(s){m.$q.dialog({title:"Anular Venta",message:"¿Está seguro de anular la venta?",ok:"Sí",cancel:"No"}).onOk(()=>{u.value=!0,m.$axios.put(`/ventas/${s}/anular`).then(()=>{T()}).finally(()=>{u.value=!1})})}function ee(){$.value=[{id:"",name:"Todos"}],m.$axios.get("/usersSucursal").then(s=>{s.data.forEach(e=>{$.value.push({id:e.id,name:e.name})})})}function T(){u.value=!0,m.$axios.get("/ventas",{params:{fechaInicio:b.value,fechaFin:x.value,user_id:w.value}}).then(s=>{h.value=s.data,M.value=s.data}).finally(()=>{u.value=!1})}const le=te(()=>{let s=0;return h.value.forEach(e=>{e.anulada||e.detalles.forEach(o=>{s+=(o.precio-o.precio_compra)*o.cantidad})}),s.toFixed(2)});return(s,e)=>(n(),c(B,null,[l(de,{class:"q-pa-xs"},{default:t(()=>[l(q,{flat:"",bordered:""},{default:t(()=>[l(F,{class:"q-pa-xs"},{default:t(()=>[l(R,{onSubmit:P(T,["prevent"])},{default:t(()=>[a("div",re,[a("div",ce,[l(A,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=o=>b.value=o),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",me,[l(A,{modelValue:x.value,"onUpdate:modelValue":e[1]||(e[1]=o=>x.value=o),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",pe,[s.$store.user.role==="Admin"?(n(),p(N,{key:0,modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=o=>w.value=o),label:"Usuario",outlined:"",dense:"",options:$.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):f("",!0)]),a("div",fe,[l(y,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:u.value},null,8,["loading"])]),a("div",ve,[s.$store.user.role==="Admin"?(n(),p(N,{key:0,modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=o=>g.value=o),label:"Tipo Reporte",outlined:"",dense:"",options:G.value},null,8,["modelValue","options"])):f("",!0)]),a("div",_e,[s.$store.user.role==="Admin"?(n(),p(y,{key:0,style:{width:"150px"},label:"Imprimir",color:"indigo",icon:"print","no-caps":"",loading:u.value,onClick:Z},null,8,["loading"])):f("",!0)]),e[10]||(e[10]=a("div",{class:"col-12 col-md-12 flex flex-center"},null,-1)),a("div",be,[l(A,{modelValue:k.value,"onUpdate:modelValue":[e[4]||(e[4]=o=>k.value=o),W],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])]),a("div",xe,[l(y,{style:{width:"150px"},label:"Venta",color:"positive",onClick:e[5]||(e[5]=o=>s.$router.push("/ventas/add")),"no-caps":"",icon:"add_circle_outline",loading:u.value},null,8,["loading"])]),e[11]||(e[11]=a("div",{class:"col-12 col-md-4 flex flex-center"},null,-1)),a("div",he,[l(y,{style:{width:"150px"},label:"Cerrar Caja",color:"red",onClick:H,"no-caps":"",icon:"point_of_sale",loading:u.value},null,8,["loading"])])])]),_:1}),a("div",ge,[a("div",ye,[l(D,{bordered:"",padding:"",dense:""},{default:t(()=>[S((n(),p(L,{clickable:""},{default:t(()=>[l(v,{avatar:""},{default:t(()=>[l(U,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),l(v,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",Ce,d(h.value.length)+" ventas ",1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[12]||(e[12]=[C(" Cantida de ventas ")])),_:1})]),_:1})]),_:1})),[[I]])]),_:1})]),a("div",we,[s.$store.user.role==="Admin"?(n(),p(D,{key:0,bordered:"",padding:"",dense:""},{default:t(()=>[S((n(),p(L,{clickable:""},{default:t(()=>[l(v,{avatar:""},{default:t(()=>[l(U,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(v,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",Ve," Bs "+d(h.value.filter(o=>!o.anulada).reduce((o,i)=>o+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[13]||(e[13]=[C(" Total de ventas ")])),_:1})]),_:1})]),_:1})),[[I]])]),_:1})):f("",!0)]),a("div",ke,[l(D,{bordered:"",padding:"",dense:""},{default:t(()=>[S((n(),p(L,{clickable:""},{default:t(()=>[l(v,{avatar:""},{default:t(()=>[l(U,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(v,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",Qe," Bs "+d(h.value.filter(o=>o.anulada).reduce((o,i)=>o+parseFloat(i.total),0).toFixed(2)),1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[14]||(e[14]=[C(" Total de reservas canceladas ")])),_:1})]),_:1})]),_:1})),[[I]])]),_:1})]),a("div",Ae,[l(D,{bordered:"",padding:"",dense:""},{default:t(()=>[S((n(),p(L,{clickable:""},{default:t(()=>[l(v,{avatar:""},{default:t(()=>[l(U,{color:"amber","text-color":"white",icon:"trending_up"})]),_:1}),l(v,null,{default:t(()=>[l(_,{lines:"1"},{default:t(()=>[a("span",$e," Bs "+d(le.value),1)]),_:1}),l(_,{caption:"",lines:"2"},{default:t(()=>e[15]||(e[15]=[C(" Ganancia total ")])),_:1})]),_:1})]),_:1})),[[I]])]),_:1})])])]),_:1})]),_:1}),l(q,{flat:"",bordered:"",class:"q-mt-md"},{default:t(()=>[l(F,null,{default:t(()=>[l(ie,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:t(()=>[e[16]||(e[16]=a("thead",null,[a("tr",{class:"bg-primary text-white"},[a("th",null,"Acciones"),a("th",null,"Fecha"),a("th",null,"Total"),a("th",null,"Nombre Cliente"),a("th",null,"Usuario"),a("th",null,"Detalle"),a("th",null,"Agencia")])],-1)),a("tbody",null,[(n(!0),c(B,null,E(h.value,o=>(n(),c("tr",{key:o.id},[a("td",null,[C(d(o.id)+" ",1),o.anulada?(n(),c("div",Fe,[l(ne,{color:"red","text-color":"white",label:"Anulada"})])):(n(),p(y,{key:0,style:{width:"80px"},icon:"remove_circle_outline",color:"negative",dense:"",onClick:i=>X(o.id),label:"Anular","no-caps":"",size:"10px"},null,8,["onClick"]))]),a("td",null,d(o.fecha),1),a("td",null,d(o.total),1),a("td",null,d(o.nombre),1),a("td",null,d(o.user?.name),1),a("td",null,[a("div",Se,[(n(!0),c(B,null,E(o.detalles,(i,Y)=>(n(),c("span",{key:Y},[Y>0?(n(),c("span",Ue,", ")):f("",!0),C(" "+d(i.producto)+" ("+d(i.cantidad)+") ",1),i.precio>0?(n(),c("span",Ie,[C(" Bs "+d(i.precio.toFixed(2))+" ",1),s.$store.user.role==="Admin"?(n(),c("span",De,d(i.precio-i.precio_compra>0?`(+${((i.precio-i.precio_compra)*i.cantidad).toFixed(2)})`:""),1)):f("",!0)])):f("",!0),i.precio===0?(n(),c("span",Le,"Gratis")):f("",!0)]))),128))])]),a("td",null,d(o.agencia),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(se,{modelValue:Q.value,"onUpdate:modelValue":e[9]||(e[9]=o=>Q.value=o),persistent:""},{default:t(()=>[l(q,{flat:"",bordered:"",style:{width:"350px"}},{default:t(()=>[l(F,{class:"row items-center q-pb-none"},{default:t(()=>[e[17]||(e[17]=a("div",{class:"text-bold"}," Cerrar Caja ",-1)),l(ue),l(y,{flat:"",dense:"",icon:"close",onClick:e[6]||(e[6]=o=>Q.value=!1)})]),_:1}),l(F,null,{default:t(()=>[l(R,{onSubmit:P(K,["prevent"])},{default:t(()=>[l(A,{modelValue:V.value.monto_final,"onUpdate:modelValue":e[7]||(e[7]=o=>V.value.monto_final=o),label:"Monto Final",type:"number",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(A,{type:"textarea",modelValue:V.value.observacion,"onUpdate:modelValue":e[8]||(e[8]=o=>V.value.observacion=o),label:"Observación",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(y,{label:"Cerrar Caja",color:"red",type:"submit",loading:u.value,"no-caps":"",icon:"point_of_sale",class:"q-mt-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[18]||(e[18]=a("div",{id:"myElement",class:"hidden"},null,-1))],64))}};export{Je as default};
