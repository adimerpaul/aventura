import{g as X,r as i,l as ee,a4 as Q,o as d,a as l,b as a,w as t,Q as F,e as A,as as O,ap as w,c,a3 as $,f,Z as U,a2 as I,t as r,a0 as T,a1 as D,a5 as Y,a6 as le,h as ae}from"./index-DmXF2vU7.js";import{Q as P}from"./QSelect-B9TjULO2.js";import{Q as N}from"./QForm-CuTfOJli.js";import{d as L,Q as j,a as g,b as h,c as oe}from"./QList-BmsGfYz3.js";import{Q as te}from"./QMarkupTable-aS8TMezk.js";import{Q as ne}from"./QPage-DGqXvlAa.js";import{Q as se}from"./QSpace-CI6q1rwz.js";import{h as R}from"./moment-C5S46NFB.js";import{I as q}from"./impresion-BcmyQcBB.js";import"./format-Chq1_pav.js";const ie={class:"row"},de={class:"col-12 col-md-2"},ue={class:"col-12 col-md-2"},re={class:"col-12 col-md-2"},ce={class:"col-12 col-md-2 flex flex-center"},me={class:"col-12 col-md-2"},ve={class:"col-12 col-md-2 flex flex-center"},pe={class:"col-12 col-md-4"},fe={class:"col-12 col-md-2 flex flex-center"},_e={class:"col-12 col-md-2 flex flex-center"},be={class:"row"},xe={class:"col-12 col-md-4 q-pa-xs"},ge={class:"text-weight-bold"},he={class:"col-12 col-md-4 q-pa-xs"},Ce={class:"text-weight-bold"},Ve={class:"col-12 col-md-4 q-pa-xs"},we={class:"text-weight-bold"},ye={key:1},ke={style:{"max-width":"200px","wrap-option":"wrap"}},qe={__name:"Ventas",setup(Qe){const{proxy:u}=X(),m=i(R().format("YYYY-MM-DD")),v=i(R().format("YYYY-MM-DD")),_=i([]),B=i([]),s=i(!1),C=i(""),y=i([]),b=i(""),p=i("CAJA"),V=i(!1),x=i({}),M=i([]),E=i(["CAJA","PRODUCTOS","SALA"]);ee(()=>{S(),W(),J()});function J(){u.$axios.get("/productos").then(n=>{M.value=n.data})}function z(){if(!b.value&&p.value!=="PRODUCTOS"){u.$alert.error("Seleccione un usuario","Por favor");return}s.value=!0;const n=y.value.find(e=>e.id===b.value);u.$axios.post("/ventas/imprimir",{user_id:b.value,fechaInicio:m.value,fechaFin:v.value,reporte:p.value}).then(e=>{p.value==="CAJA"&&q.imprimirCaja(e.data,m.value,v.value,n.name),p.value==="PRODUCTOS"&&q.imprimirProductos(e.data,m.value,v.value,n.name,M.value),p.value==="SALA"&&q.imprimirSalas(e.data,m.value,v.value,n.name)}).finally(()=>{s.value=!1})}function Z(){V.value=!0,x.value={monto_inicial:0,monto_final:0,observacion:""}}function G(){s.value=!0,u.$axios.post("/cajas",x.value).then(n=>{V.value=!1,u.$alert.success("Registrado correctamente",n.data)}).finally(()=>{s.value=!1})}function H(){_.value=B.value.filter(n=>n.nombre.toLowerCase().includes(C.value.toLowerCase())||n.user?.name.toLowerCase().includes(C.value.toLowerCase())||n.detalleText.toLowerCase().includes(C.value.toLowerCase()))}function K(n){u.$q.dialog({title:"Anular Venta",message:"¿Está seguro de anular la venta?",ok:"Sí",cancel:"No"}).onOk(()=>{s.value=!0,u.$axios.put(`/ventas/${n}/anular`).then(()=>{S()}).finally(()=>{s.value=!1})})}function W(){y.value=[{id:"",name:"Todos"}],u.$axios.get("/usersSucursal").then(n=>{n.data.forEach(e=>{y.value.push({id:e.id,name:e.name})})})}function S(){s.value=!0,u.$axios.get("/ventas",{params:{fechaInicio:m.value,fechaFin:v.value,user_id:b.value}}).then(n=>{_.value=n.data,B.value=n.data}).finally(()=>{s.value=!1})}return(n,e)=>(d(),Q(Y,null,[l(ne,{class:"q-pa-xs"},{default:t(()=>[l(F,{flat:"",bordered:""},{default:t(()=>[l(A,{class:"q-pa-xs"},{default:t(()=>[l(N,{onSubmit:O(S,["prevent"])},{default:t(()=>[a("div",ie,[a("div",de,[l(w,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),label:"Fecha Inicio",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",ue,[l(w,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=o=>v.value=o),label:"Fecha Fin",type:"date",outlined:"",dense:""},null,8,["modelValue"])]),a("div",re,[n.$store.user.role==="Admin"?(d(),c(P,{key:0,modelValue:b.value,"onUpdate:modelValue":e[2]||(e[2]=o=>b.value=o),label:"Usuario",outlined:"",dense:"",options:y.value,"option-label":"name","option-value":"id","emit-value":"","map-options":""},null,8,["modelValue","options"])):$("",!0)]),a("div",ce,[l(f,{style:{width:"150px"},label:"Buscar",color:"primary",type:"submit",icon:"search","no-caps":"",loading:s.value},null,8,["loading"])]),a("div",me,[n.$store.user.role==="Admin"?(d(),c(P,{key:0,modelValue:p.value,"onUpdate:modelValue":e[3]||(e[3]=o=>p.value=o),label:"Tipo Reporte",outlined:"",dense:"",options:E.value},null,8,["modelValue","options"])):$("",!0)]),a("div",ve,[n.$store.user.role==="Admin"?(d(),c(f,{key:0,style:{width:"150px"},label:"Imprimir",color:"indigo",icon:"print","no-caps":"",loading:s.value,onClick:z},null,8,["loading"])):$("",!0)]),e[10]||(e[10]=a("div",{class:"col-12 col-md-12 flex flex-center"},null,-1)),a("div",pe,[l(w,{modelValue:C.value,"onUpdate:modelValue":[e[4]||(e[4]=o=>C.value=o),H],label:"Filtro",outlined:"",dense:""},null,8,["modelValue"])]),a("div",fe,[l(f,{style:{width:"150px"},label:"Venta",color:"positive",onClick:e[5]||(e[5]=o=>n.$router.push("/ventas/add")),"no-caps":"",icon:"add_circle_outline",loading:s.value},null,8,["loading"])]),e[11]||(e[11]=a("div",{class:"col-12 col-md-4 flex flex-center"},null,-1)),a("div",_e,[l(f,{style:{width:"150px"},label:"Cerrar Caja",color:"red",onClick:Z,"no-caps":"",icon:"point_of_sale",loading:s.value},null,8,["loading"])])])]),_:1}),a("div",be,[a("div",xe,[l(L,{bordered:"",padding:"",dense:""},{default:t(()=>[U((d(),c(j,{clickable:""},{default:t(()=>[l(g,{avatar:""},{default:t(()=>[l(I,{color:"indigo","text-color":"white",icon:"event"})]),_:1}),l(g,null,{default:t(()=>[l(h,{lines:"1"},{default:t(()=>[a("span",ge,r(_.value.length)+" ventas ",1)]),_:1}),l(h,{caption:"",lines:"2"},{default:t(()=>e[12]||(e[12]=[T(" Cantida de ventas ")])),_:1})]),_:1})]),_:1})),[[D]])]),_:1})]),a("div",he,[n.$store.user.role==="Admin"?(d(),c(L,{key:0,bordered:"",padding:"",dense:""},{default:t(()=>[U((d(),c(j,{clickable:""},{default:t(()=>[l(g,{avatar:""},{default:t(()=>[l(I,{color:"green","text-color":"white",icon:"attach_money"})]),_:1}),l(g,null,{default:t(()=>[l(h,{lines:"1"},{default:t(()=>[a("span",Ce," Bs "+r(_.value.filter(o=>!o.anulada).reduce((o,k)=>o+parseFloat(k.total),0).toFixed(2)),1)]),_:1}),l(h,{caption:"",lines:"2"},{default:t(()=>e[13]||(e[13]=[T(" Total de ventas ")])),_:1})]),_:1})]),_:1})),[[D]])]),_:1})):$("",!0)]),a("div",Ve,[l(L,{bordered:"",padding:"",dense:""},{default:t(()=>[U((d(),c(j,{clickable:""},{default:t(()=>[l(g,{avatar:""},{default:t(()=>[l(I,{color:"red","text-color":"white",icon:"cancel"})]),_:1}),l(g,null,{default:t(()=>[l(h,{lines:"1"},{default:t(()=>[a("span",we," Bs "+r(_.value.filter(o=>o.anulada).reduce((o,k)=>o+parseFloat(k.total),0).toFixed(2)),1)]),_:1}),l(h,{caption:"",lines:"2"},{default:t(()=>e[14]||(e[14]=[T(" Total de reservas canceladas ")])),_:1})]),_:1})]),_:1})),[[D]])]),_:1})])])]),_:1})]),_:1}),l(F,{flat:"",bordered:"",class:"q-mt-md"},{default:t(()=>[l(A,null,{default:t(()=>[l(te,{"wrap-cells":"",dense:"",flat:"",bordered:""},{default:t(()=>[e[15]||(e[15]=a("thead",null,[a("tr",null,[a("th",null,"Acciones"),a("th",null,"Fecha"),a("th",null,"Total"),a("th",null,"Nombre Cliente"),a("th",null,"Usuario"),a("th",null,"Detalle"),a("th",null,"Agencia")])],-1)),a("tbody",null,[(d(!0),Q(Y,null,le(_.value,o=>(d(),Q("tr",{key:o.id},[a("td",null,[o.anulada?(d(),Q("div",ye,[l(oe,{color:"red","text-color":"white",label:"Anulada"})])):(d(),c(f,{key:0,style:{width:"80px"},icon:"remove_circle_outline",color:"negative",dense:"",onClick:k=>K(o.id),label:"Anular","no-caps":"",size:"10px"},null,8,["onClick"]))]),a("td",null,r(o.fecha),1),a("td",null,r(o.total),1),a("td",null,r(o.nombre),1),a("td",null,r(o.user?.name),1),a("td",null,[a("div",ke,r(o.detalleText),1)]),a("td",null,r(o.agencia),1)]))),128))])]),_:1})]),_:1})]),_:1})]),_:1}),l(ae,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=o=>V.value=o),persistent:""},{default:t(()=>[l(F,{flat:"",bordered:"",style:{width:"350px"}},{default:t(()=>[l(A,{class:"row items-center q-pb-none"},{default:t(()=>[e[16]||(e[16]=a("div",{class:"text-bold"}," Cerrar Caja ",-1)),l(se),l(f,{flat:"",dense:"",icon:"close",onClick:e[6]||(e[6]=o=>V.value=!1)})]),_:1}),l(A,null,{default:t(()=>[l(N,{onSubmit:O(G,["prevent"])},{default:t(()=>[l(w,{modelValue:x.value.monto_final,"onUpdate:modelValue":e[7]||(e[7]=o=>x.value.monto_final=o),label:"Monto Final",type:"number",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(w,{type:"textarea",modelValue:x.value.observacion,"onUpdate:modelValue":e[8]||(e[8]=o=>x.value.observacion=o),label:"Observación",outlined:"",dense:"",hint:""},null,8,["modelValue"]),l(f,{label:"Cerrar Caja",color:"red",type:"submit",loading:s.value,"no-caps":"",icon:"point_of_sale",class:"q-mt-md"},null,8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e[17]||(e[17]=a("div",{id:"myElement",class:"hidden"},null,-1))],64))}};export{qe as default};
